<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конструктор Целевых Страниц</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Базовые стили */
        body{font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #f9fafb; /* bg-gray-50 по умолчанию */
            color: #1f2937; /* text-gray-800 по умолчанию */
            scroll-behavior: smooth;}/* Стили боковой панели редактора */
        .editor-drawer{position: fixed;
            left: -420px; /* Скрыто по умолчанию, чуть больше ширины */
            top: 0;
            height: 100vh;
            width: 400px;
            background-color: #ffffff;
            transition: all 0.3s ease-in-out;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: 2px 0 15px rgba(0,0,0,0.2);
            padding: 1.5rem;
            border-radius: 0 10px 10px 0;
            box-sizing: border-box; /* Включает padding в ширину */}.editor-drawer.open{left: 0;}.editor-drawer.right{left: auto;
            right: -420px; /* Скрыто справа */
            border-radius: 10px 0 0 10px;
            box-shadow: -2px 0 15px rgba(0,0,0,0.2);}.editor-drawer.right.open{right: 0;}.editor-toggle{position: absolute;
            right: -45px; /* Кнопка снаружи для левой позиции */
            top: 2rem;
            width: 45px;
            height: 45px;
            background: #4f46e5; /* bg-indigo-600 */
            color: white;
            border-radius: 0 8px 8px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 2px 0 8px rgba(0,0,0,0.15);
            font-size: 1.5rem;
            transition: background-color 0.2s ease;}.editor-drawer.right .editor-toggle{left: -45px; /* Кнопка снаружи для правой позиции */
            right: auto;
            border-radius: 8px 0 0 8px;
            box-shadow: -2px 0 8px rgba(0,0,0,0.15);}.editor-toggle:hover{background-color: #4338ca; /* bg-indigo-700 */}/* Видимость секций */
        .section-hidden{display: none !important; /* Использовать !important для переопределения значений Tailwind */}/* Эффекты анимации */
        .zoom-in{transition: transform 0.3s ease-in-out;}.zoom-in:hover{transform: scale(1.02);}.fade-in{animation: fadeIn 0.8s ease-out;}@keyframes fadeIn{from{opacity: 0; transform: translateY(20px);}to{opacity: 1; transform: translateY(0);}}/* Градиенты фона (для секции Hero) */
        .gradient-bg-1{background: linear-gradient(to right, #6dd5ed, #2193b0);}/* Синий */
        .gradient-bg-2{background: linear-gradient(to right, #ee9ca7, #ffdde1);}/* Розовый */
        .gradient-bg-3{background: linear-gradient(to right, #4facfe, #00f2fe);}/* Голубой */
        .gradient-bg-4{background: linear-gradient(to right, #fbd786, #f7797d);}/* Закат */
        .gradient-bg-5{background: linear-gradient(to right, #c2e59c, #64b3f4);}/* Зелено-синий */

        /* Вспомогательные классы для полей ввода редактора */
        .editor-input{width: 100%;
            padding: 0.5rem 0.75rem;
            border-width: 1px;
            border-color: #d1d5db; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            font-size: 0.95rem;
            line-height: 1.5;
            color: #374151; /* text-gray-700 */
            background-color: #ffffff;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;}.editor-input:focus{border-color: #6366f1; /* focus:border-indigo-500 */
            outline: 0;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); /* focus:ring-indigo-200 */}.editor-textarea{min-height: 60px;
            resize: vertical;}.editor-select{appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l4 4 4-4'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1em;
            padding-right: 2.5rem;}.editor-checkbox{height: 1.25rem;
            width: 1.25rem;
            border-radius: 0.25rem;
            border: 1px solid #d1d5db;
            background-color: #ffffff;
            cursor: pointer;}.editor-label{display: block;
            margin-bottom: 0.25rem;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #374151; /* text-gray-700 */}.remove-item-btn{position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #ef4444; /* bg-red-500 */
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease;
            z-index: 5;}.remove-item-btn:hover{background-color: #dc2626; /* bg-red-600 */}.add-item-btn{display: block;
            width: 100%;
            padding: 0.6rem 1rem;
            margin-top: 1rem;
            border-radius: 0.375rem;
            background-color: #22c55e; /* bg-green-500 */
            color: white;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease;}.add-item-btn:hover{background-color: #16a34a; /* bg-green-600 */}.section-editor-block{border: 1px solid #e5e7eb; /* border-gray-200 */
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            background-color: #f9fafb; /* bg-gray-50 */}.section-editor-header{padding: 1rem;
            cursor: pointer;
            background-color: #e5e7eb; /* bg-gray-200 */
            border-bottom: 1px solid #d1d5db;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            border-radius: 0.5rem 0.5rem 0 0;}.section-editor-header.collapsed{border-bottom: none;
            border-radius: 0.5rem;}.section-editor-header:hover{background-color: #d1d5db; /* bg-gray-300 */}.section-editor-content{padding: 1rem;
            border-top: none;}.section-editor-content.hidden{display: none;}.accordion-arrow{transition: transform 0.2s ease-in-out;}.accordion-arrow.rotate{transform: rotate(90deg);}/* Стили для загрузчика */
        #config-url-loader{position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #1a202c; /* bg-gray-900 */
            padding: 1rem;
            color: #ffffff;
            z-index: 1000; /* Убедитесь, что он сверху */
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;}#config-url-loader.open{transform: translateY(0);}/* Новые стили для кнопок меню форматирования/цвета */
        .format-menu-btn, .color-menu-btn{background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #6b7280; /* text-gray-500 */
            margin-left: 0.5rem;
            padding: 0.2rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s ease;}.format-menu-btn:hover, .color-menu-btn:hover{background-color: #e5e7eb; /* bg-gray-200 */}.input-with-controls{display: flex;
            align-items: center;
            position: relative;}.input-with-controls input, .input-with-controls textarea, .input-with-controls select{flex-grow: 1;}/* Стили для всплывающего меню форматирования/цвета */
        .popup-menu{position: absolute;
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1001; /* Поверх редактора */
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 180px;}.popup-menu label{font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.2rem;}.popup-menu input[type="range"]{width: 100%;
            -webkit-appearance: none;
            height: 8px;
            background: #d1d5db;
            border-radius: 5px;
            outline: none;}.popup-menu input[type="range"]::-webkit-slider-thumb{-webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            box-shadow: 0 0 2px rgba(0,0,0,0.2);}.popup-menu input[type="color"]{width: 100%;
            height: 30px;
            padding: 0;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;}.popup-menu button{background-color: #6366f1;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: background-color 0.2s ease;}.popup-menu button:hover{background-color: #4f46e5;}/* Стили для фоновых изображений секций */
        .section-background-image{position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1; /* Под содержимым */}.section-content-wrapper{position: relative; /* Чтобы z-index работал */
            z-index: 10; /* Поверх фонового изображения */}</style>
</head>
<body class="bg-gray-50 font-sans">

    <div class="editor-drawer" id="editor-drawer">
        <button class="editor-toggle" id="editor-toggle">⚙️</button>
        <h2 class="text-2xl font-bold mb-6 text-gray-800">Редактор Страницы</h2>

        <div class="mb-4 flex justify-around">
            <button id="editor-position-left" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300">Слева</button>
            <button id="editor-position-right" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300">Справа</button>
        </div>


        <div class="section-editor-block" data-section="global">
            <div class="section-editor-header" data-toggle="global">
                Глобальные Настройки
                <span class="accordion-arrow">▶</span>
            </div>
            <div class="section-editor-content">
                <div class="mb-4">
                    <label for="global-bg" class="editor-label">Базовый цвет фона</label>
                    <input type="color" id="global-bg" class="editor-input h-10 p-1">
                </div>
            </div>
        </div>

<div class="section-editor-block" data-section="navbar">
    <div class="section-editor-header" data-toggle="navbar">
        Навигационная Панель
        <div class="flex items-center space-x-2">
            <input type="checkbox" id="toggle-navbar" class="editor-checkbox section-toggle" data-section="navbar" checked>
            <span class="accordion-arrow">▶</span>
        </div>
    </div>
    <div class="section-editor-content">
        <div class="mb-3">
            <label for="nav-bg-color" class="editor-label">Цвет фона навигации</label>
            <input type="color" id="nav-bg-color" class="editor-input h-10 p-1">
        </div>
        <div class="mb-3">
            <label for="nav-text-color" class="editor-label">Цвет текста навигации</label>
            <input type="color" id="nav-text-color" class="editor-input h-10 p-1">
        </div>
        <div class="mb-3">
            <label for="navbar-logo-text" class="editor-label">Текст логотипа</label>
            <input type="text" id="navbar-logo-text" class="editor-input">

        </div>
        <div class="mb-3">
            <label for="navbar-logo-image-url" class="editor-label">URL изображения логотипа</label>
            <input type="text" id="navbar-logo-image-url" class="editor-input" placeholder="Оставьте пустым для текстового лого">
        </div>
        <div class="mb-3">
            <label for="navbar-logo-image-width" class="editor-label">Ширина изображения (px или auto)</label>
            <input type="text" id="navbar-logo-image-width" class="editor-input" placeholder="например: 120px или auto">
        </div>
        <div class="mb-3">
            <label for="navbar-logo-image-height" class="editor-label">Высота изображения (px или auto)</label>
            <input type="text" id="navbar-logo-image-height" class="editor-input" placeholder="например: 40px или auto">
        </div>
        <div id="navbar-links-editor" class="space-y-4 p-2 border border-gray-200 rounded-md bg-white">
        </div>
        <button id="add-nav-link-btn" class="add-item-btn bg-blue-500 hover:bg-blue-600">Добавить ссылку навигации</button>
    </div>
</div>

        <div class="section-editor-block" data-section="hero">
            <div class="section-editor-header" data-toggle="hero">
                Секция "Герой"
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="toggle-hero" class="editor-checkbox section-toggle" data-section="hero" checked>
                    <span class="accordion-arrow">▶</span>
                </div>
            </div>
            <div class="section-editor-content">
                <div class="mb-3">
                    <label for="hero-title-input" class="editor-label">Заголовок</label>
                    <div class="input-with-controls">
                        <input type="text" id="hero-title-input" class="editor-input">
                        <button class="format-menu-btn" data-target="hero-title">⋮</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="hero-desc-input" class="editor-label">Описание</label>
                    <div class="input-with-controls">
                        <textarea id="hero-desc-input" class="editor-input editor-textarea" rows="3"></textarea>
                        <button class="format-menu-btn" data-target="hero-description">⋮</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="hero-btn-text-input" class="editor-label">Текст кнопки</label>
                    <div class="input-with-controls">
                        <input type="text" id="hero-btn-text-input" class="editor-input">
                        <button class="format-menu-btn" data-target="hero-button">⋮</button>
                    </div>
                    <div class="mb-3">
                        <label for="hero-button-text-color-picker" class="editor-label">Цвет текста кнопки</label>
                        <input type="color" id="hero-button-text-color-picker" class="editor-input h-10 p-1">
                    </div>
                    <div class="mb-3">
                        <label for="hero-button-bg-color-picker" class="editor-label">Цвет фона кнопки</label>
                        <input type="color" id="hero-button-bg-color-picker" class="editor-input h-10 p-1">
                    </div>

                </div>
                <div class="mb-3">
                    <label for="hero-bg-type-select" class="editor-label">Тип фона</label>
                    <select id="hero-bg-type-select" class="editor-input editor-select">
                        <option value="color">Сплошной цвет</option>
                        <option value="gradient">Градиент</option>
                        <option value="image">Изображение</option>
                    </select>
                </div>
                <div id="hero-color-options" class="mb-3">
                    <label for="hero-bg-color-picker" class="editor-label">Цвет фона</label>
                    <input type="color" id="hero-bg-color-picker" class="editor-input h-10 p-1">
                </div>
                <div id="hero-gradient-options" class="mb-3 hidden">
                    <label for="hero-gradient-select" class="editor-label">Градиент фона</label>
                    <select id="hero-gradient-select" class="editor-input editor-select">
                        <option value="gradient-bg-1">Синий градиент</option>
                        <option value="gradient-bg-2">Розовый градиент</option>
                        <option value="gradient-bg-3">Голубой градиент</option>
                        <option value="gradient-bg-4">Градиент заката</option>
                        <option value="gradient-bg-5">Зелено-синий градиент</option>
                    </select>
                </div>
                <div id="hero-image-options" class="mb-3 hidden">
                    <label for="hero-image-url-input" class="editor-label">URL фонового изображения</label>
                    <input type="text" id="hero-image-url-input" class="editor-input" placeholder="например, https://example.com/image.jpg">
                    <label for="hero-image-opacity-input" class="editor-label mt-2">Прозрачность изображения (0-1)</label>
                    <input type="range" id="hero-image-opacity-input" class="editor-input" min="0" max="1" step="0.05" value="1">
                </div>
                <div class="mb-3">
                    <label for="hero-text-color-picker" class="editor-label">Цвет текста</label>
                    <input type="color" id="hero-text-color-picker" class="editor-input h-10 p-1">
                </div>
            </div>
        </div>

        <div class="section-editor-block" data-section="about">
            <div class="section-editor-header" data-toggle="about">
                Секция "О нас"
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="toggle-about" class="editor-checkbox section-toggle" data-section="about" checked>
                    <span class="accordion-arrow">▶</span>
                </div>
            </div>
            <div class="section-editor-content">
                <div class="mb-3">
                    <label for="about-title-input" class="editor-label">Заголовок секции</label>
                    <div class="input-with-controls">
                        <input type="text" id="about-title-input" class="editor-input">
                        <button class="format-menu-btn" data-target="about-title-display">⋮</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="about-desc-input" class="editor-label">Описание</label>
                    <div class="input-with-controls">
                        <textarea id="about-desc-input" class="editor-input editor-textarea" rows="3"></textarea>
                        <button class="format-menu-btn" data-target="about-description-1-display">⋮</button>
                    </div>
                </div>
                <div class="mb-3">
                  <label for="about-desc2-input" class="editor-label">Второе описание</label>
                  <textarea id="about-desc2-input" class="editor-input editor-textarea" rows="3"></textarea>
                </div>

                <div class="mb-3">
                    <label for="about-values-title-input" class="editor-label">Заголовок "Наши ценности"</label>
                    <div class="input-with-controls">
                        <input type="text" id="about-values-title-input" class="editor-input">
                        <button class="format-menu-btn" data-target="about-values-title-display">⋮</button>
                    </div>
                </div>
                <div id="about-values-editor-list" class="space-y-3 p-2 border border-gray-200 rounded-md bg-white">
                    </div>
                <button id="add-about-value-btn" class="add-item-btn bg-blue-500 hover:bg-blue-600">Добавить ценность</button>
                <div class="mb-3 mt-4">
                    <label for="about-bg-color-picker" class="editor-label">Цвет фона</label>
                    <input type="color" id="about-bg-color-picker" class="editor-input h-10 p-1">
                </div>
                <div class="mb-3">
                    <label for="about-bg-image-url-input" class="editor-label">URL фонового изображения</label>
                    <input type="text" id="about-bg-image-url-input" class="editor-input" placeholder="Оставьте пустым для сплошного цвета">
                    <label for="about-bg-image-opacity-input" class="editor-label mt-2">Прозрачность изображения (0-1)</label>
                    <input type="range" id="about-bg-image-opacity-input" class="editor-input" min="0" max="1" step="0.05" value="1">
                </div>
                <div class="mb-3">
                    <label for="about-text-color-picker" class="editor-label">Цвет текста</label>
                    <input type="color" id="about-text-color-picker" class="editor-input h-10 p-1">
                </div>
            </div>
        </div>

        <div class="section-editor-block" data-section="services">
            <div class="section-editor-header" data-toggle="services">
                Секция "Услуги"
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="toggle-services" class="editor-checkbox section-toggle" data-section="services" checked>
                    <span class="accordion-arrow">▶</span>
                </div>
            </div>
            <div class="section-editor-content">
                <div class="mb-3">
                    <label for="services-title-input" class="editor-label">Заголовок секции</label>
                    <div class="input-with-controls">
                        <input type="text" id="services-title-input" class="editor-input">
                        <button class="format-menu-btn" data-target="services-title-display">⋮</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="services-layout-select" class="editor-label">Расположение</label>
                    <select id="services-layout-select" class="editor-input editor-select">
                        <option value="md:grid-cols-3">3 Колонки</option>
                        <option value="md:grid-cols-2">2 Колонки</option>
                        <option value="md:grid-cols-1">1 Колонка</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="services-card-padding-select" class="editor-label">Отступы карточек</label>
                    <select id="services-card-padding-select" class="editor-input editor-select">
                        <option value="p-4">Маленький (16px)</option>
                        <option value="p-6">Средний (24px)</option>
                        <option value="p-8">Большой (32px)</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="services-gap-select" class="editor-label">Промежуток между карточками</label>
                    <select id="services-gap-select" class="editor-input editor-select">
                        <option value="gap-4">Маленький (16px)</option>
                        <option value="gap-6">Средний (24px)</option>
                        <option value="gap-8">Большой (32px)</option>
                    </select>
                </div>
                <div id="services-list-editor" class="space-y-4 p-2 border border-gray-200 rounded-md bg-white">
                    </div>
                <button id="add-service-btn" class="add-item-btn bg-blue-500 hover:bg-blue-600">Добавить услугу</button>
                <div class="mb-3 mt-4">
                    <label for="services-bg-color-picker" class="editor-label">Цвет фона</label>
                    <input type="color" id="services-bg-color-picker" class="editor-input h-10 p-1">
                </div>
                <div class="mb-3">
                    <label for="services-bg-image-url-input" class="editor-label">URL фонового изображения</label>
                    <input type="text" id="services-bg-image-url-input" class="editor-input" placeholder="Оставьте пустым для сплошного цвета">
                    <label for="services-bg-image-opacity-input" class="editor-label mt-2">Прозрачность изображения (0-1)</label>
                    <input type="range" id="services-bg-image-opacity-input" class="editor-input" min="0" max="1" step="0.05" value="1">
                </div>
                <div class="mb-3">
                    <label for="services-text-color-picker" class="editor-label">Цвет текста</label>
                    <input type="color" id="services-text-color-picker" class="editor-input h-10 p-1">
                </div>
            </div>
        </div>

        <div class="section-editor-block" data-section="features">
            <div class="section-editor-header" data-toggle="features">
                Секция "Особенности"
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="toggle-features" class="editor-checkbox section-toggle" data-section="features" checked>
                    <span class="accordion-arrow">▶</span>
                </div>
            </div>
            <div class="section-editor-content">
                <div class="mb-3">
                    <label for="features-title-input" class="editor-label">Заголовок секции</label>
                    <div class="input-with-controls">
                        <input type="text" id="features-title-input" class="editor-input">
                        <button class="format-menu-btn" data-target="features-title-display">⋮</button>
                    </div>
                </div>
                <div id="features-list-editor" class="space-y-4 p-2 border border-gray-200 rounded-md bg-white">
                    </div>
                <button id="add-feature-btn" class="add-item-btn bg-blue-500 hover:bg-blue-600">Добавить особенность</button>
                <div class="mb-3 mt-4">
                    <label for="features-bg-color-picker" class="editor-label">Цвет фона</label>
                    <input type="color" id="features-bg-color-picker" class="editor-input h-10 p-1">
                </div>
                <div class="mb-3">
                    <label for="features-bg-image-url-input" class="editor-label">URL фонового изображения</label>
                    <input type="text" id="features-bg-image-url-input" class="editor-input" placeholder="Оставьте пустым для сплошного цвета">
                    <label for="features-bg-image-opacity-input" class="editor-label mt-2">Прозрачность изображения (0-1)</label>
                    <input type="range" id="features-bg-image-opacity-input" class="editor-input" min="0" max="1" step="0.05" value="1">
                </div>
                <div class="mb-3">
                    <label for="features-text-color-picker" class="editor-label">Цвет текста</label>
                    <input type="color" id="features-text-color-picker" class="editor-input h-10 p-1">
                </div>
            </div>
        </div>

        <div class="section-editor-block" data-section="testimonials">
            <div class="section-editor-header" data-toggle="testimonials">
                Секция "Отзывы"
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="toggle-testimonials" class="editor-checkbox section-toggle" data-section="testimonials" checked>
                    <span class="accordion-arrow">▶</span>
                </div>
            </div>
            <div class="section-editor-content">
                <div class="mb-3">
                    <label for="testimonials-title-input" class="editor-label">Заголовок секции</label>
                    <div class="input-with-controls">
                        <input type="text" id="testimonials-title-input" class="editor-input">
                        <button class="format-menu-btn" data-target="testimonials-title-display">⋮</button>
                    </div>
                </div>
                <div id="testimonials-list-editor" class="space-y-4 p-2 border border-gray-200 rounded-md bg-white">
                    </div>
                <button id="add-testimonial-btn" class="add-item-btn bg-blue-500 hover:bg-blue-600">Добавить отзыв</button>
                <div class="mb-3 mt-4">
                    <label for="testimonials-bg-color-picker" class="editor-label">Цвет фона</label>
                    <input type="color" id="testimonials-bg-color-picker" class="editor-input h-10 p-1">
                </div>
                <div class="mb-3">
                    <label for="testimonials-bg-image-url-input" class="editor-label">URL фонового изображения</label>
                    <input type="text" id="testimonials-bg-image-url-input" class="editor-input" placeholder="Оставьте пустым для сплошного цвета">
                    <label for="testimonials-bg-image-opacity-input" class="editor-label mt-2">Прозрачность изображения (0-1)</label>
                    <input type="range" id="testimonials-bg-image-opacity-input" class="editor-input" min="0" max="1" step="0.05" value="1">
                </div>
                <div class="mb-3">
                    <label for="testimonials-text-color-picker" class="editor-label">Цвет текста</label>
                    <input type="color" id="testimonials-text-color-picker" class="editor-input h-10 p-1">
                </div>
            </div>
        </div>

        <div class="section-editor-block" data-section="faq">
            <div class="section-editor-header" data-toggle="faq">
                Секция "Часто задаваемые вопросы"
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="toggle-faq" class="editor-checkbox section-toggle" data-section="faq" checked>
                    <span class="accordion-arrow">▶</span>
                </div>
            </div>
            <div class="section-editor-content">
                <div class="mb-3">
                    <label for="faq-title-input" class="editor-label">Заголовок секции</label>
                    <div class="input-with-controls">
                        <input type="text" id="faq-title-input" class="editor-input">
                        <button class="format-menu-btn" data-target="faq-title-display">⋮</button>
                    </div>
                </div>
                <div id="faq-list-editor" class="space-y-4 p-2 border border-gray-200 rounded-md bg-white">
                    </div>
                <button id="add-faq-btn" class="add-item-btn bg-blue-500 hover:bg-blue-600">Добавить вопрос</button>
                <div class="mb-3 mt-4">
                    <label for="faq-bg-color-picker" class="editor-label">Цвет фона</label>
                    <input type="color" id="faq-bg-color-picker" class="editor-input h-10 p-1">
                </div>
                <div class="mb-3">
                    <label for="faq-bg-image-url-input" class="editor-label">URL фонового изображения</label>
                    <input type="text" id="faq-bg-image-url-input" class="editor-input" placeholder="Оставьте пустым для сплошного цвета">
                    <label for="faq-bg-image-opacity-input" class="editor-label mt-2">Прозрачность изображения (0-1)</label>
                    <input type="range" id="faq-bg-image-opacity-input" class="editor-input" min="0" max="1" step="0.05" value="1">
                </div>
                <div class="mb-3">
                    <label for="faq-text-color-picker" class="editor-label">Цвет текста</label>
                    <input type="color" id="faq-text-color-picker" class="editor-input h-10 p-1">
                </div>
            </div>
        </div>

        <div class="section-editor-block" data-section="contact">
            <div class="section-editor-header" data-toggle="contact">
                Секция "Контакты"
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="toggle-contact" class="editor-checkbox section-toggle" data-section="contact" checked>
                    <span class="accordion-arrow">▶</span>
                </div>
            </div>
            <div class="section-editor-content">
                <div class="mb-3">
                    <label for="contact-title-input" class="editor-label">Заголовок секции</label>
                    <div class="input-with-controls">
                        <input type="text" id="contact-title-input" class="editor-input">
                        <button class="format-menu-btn" data-target="contact-title-display">⋮</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="contact-bg-color-picker" class="editor-label">Цвет фона</label>
                    <input type="color" id="contact-bg-color-picker" class="editor-input h-10 p-1">
                </div>
                <div class="mb-3">
                    <label for="contact-bg-image-url-input" class="editor-label">URL фонового изображения</label>
                    <input type="text" id="contact-bg-image-url-input" class="editor-input" placeholder="Оставьте пустым для сплошного цвета">
                    <label for="contact-bg-image-opacity-input" class="editor-label mt-2">Прозрачность изображения (0-1)</label>
                    <input type="range" id="contact-bg-image-opacity-input" class="editor-input" min="0" max="1" step="0.05" value="1">
                </div>
                <div class="mb-3">
                    <label for="contact-text-color-picker" class="editor-label">Цвет текста</label>
                    <input type="color" id="contact-text-color-picker" class="editor-input h-10 p-1">
                </div>
                <div class="mb-3">
  <label for="contact-info-title-input" class="editor-label">Заголовок информационного блока</label>
  <input type="text" id="contact-info-title-input" class="editor-input">
</div>
<div class="mb-3">
  <label for="contact-info-description-input" class="editor-label">Описание информационного блока</label>
  <textarea id="contact-info-description-input" class="editor-input editor-textarea" rows="3"></textarea>
</div>

                <div class="mb-3">
                    <label for="contact-email-input" class="editor-label">Email</label>
                    <div class="input-with-controls">
                        <input type="email" id="contact-email-input" class="editor-input">
                        <button class="format-menu-btn" data-target="display-contact-email">⋮</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="contact-phone-input" class="editor-label">Телефон</label>
                    <div class="input-with-controls">
                        <input type="tel" id="contact-phone-input" class="editor-input">
                        <button class="format-menu-btn" data-target="display-contact-phone">⋮</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="contact-address-input" class="editor-label">Адрес</label>
                    <div class="input-with-controls">
                        <textarea id="contact-address-input" class="editor-input editor-textarea" rows="2"></textarea>
                        <button class="format-menu-btn" data-target="display-contact-address">⋮</button>
                    </div>
                </div>

                <div class="pt-4 border-t border-gray-200 mt-4">
                    <h4 class="font-semibold mb-3 text-gray-700">Поля контактной формы</h4>
                    <div id="contact-form-fields-container" class="space-y-3 p-2 border border-gray-200 rounded-md bg-white">
                        </div>
                    <button id="add-contact-field-btn" class="add-item-btn bg-blue-500 hover:bg-blue-600">Добавить поле формы</button>
                    <div class="mt-3">
                        <label for="submit-btn-text-input" class="editor-label">Текст кнопки "Отправить"</label>
                        <div class="input-with-controls">
                            <input type="text" id="submit-btn-text-input" class="editor-input">
                            <button class="format-menu-btn" data-target="contact-form-submit-btn">⋮</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-8 pt-4 border-t border-gray-200">
            <h3 class="text-xl font-semibold mb-3 text-gray-700">Управление Конфигурацией</h3>
            <button id="save-config-btn" class="add-item-btn bg-indigo-600 hover:bg-indigo-700 mb-2">Сохранить Конфигурацию (Локально)</button>
            <button id="load-config-btn" class="add-item-btn bg-gray-600 hover:bg-gray-700 mb-2">Загрузить Конфигурацию (Локально)</button>
            <button id="export-config-js-btn" class="add-item-btn bg-green-600 hover:bg-green-700">Экспортировать как JS файл</button>
        <button id="export-static-html-btn" class="add-item-btn bg-yellow-500 hover:bg-yellow-600">Экспортировать как HTML</button>

        </div>
    </div>

    <main>
        <nav class="p-4 shadow-md flex justify-between items-center fixed w-full z-20 top-0" id="navbar">
            <div class="text-2xl font-bold" id="navbar-logo">ВашЛого</div>
            <ul class="flex space-x-4" id="nav-links">
                </ul>
        </nav>

        <section id="hero" class="relative py-20 px-4 flex flex-col justify-center items-center h-screen bg-blue-600 text-white fade-in">
            <div class="absolute inset-0 bg-cover bg-center" id="hero-background-image" style="display: none;"></div>
            <div class="relative z-10 text-center section-content-wrapper">
                <h1 class="text-5xl font-bold mb-4" id="hero-title">Добро пожаловать в наш потрясающий сервис</h1>
                <p class="text-xl mb-8 max-w-2xl" id="hero-description">Мы предлагаем лучшие решения для вашего бизнеса. Начните сегодня и увидите разницу!</p>
                <button class="bg-white text-blue-600 px-8 py-3 rounded-lg text-lg font-semibold hover:bg-gray-100 transition zoom-in" id="hero-button">Начать</button>
            </div>
        </section>

        <section id="about" class="relative py-16 px-4 bg-white fade-in">
            <div class="section-background-image" id="about-background-image"></div>
            <div class="max-w-6xl mx-auto relative z-10 section-content-wrapper">
                <h2 class="text-3xl font-bold mb-6 text-center" id="about-title-display">О нас</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <p class="mb-4 text-gray-700" id="about-description-1-display">Мы - команда увлеченных профессионалов, стремящихся предоставить исключительные результаты нашим клиентам. Благодаря многолетнему опыту в отрасли, мы помогли сотням компаний расти и добиваться успеха.</p>
                        <p class="text-gray-700" id="about-description-2-display">Наша миссия - предоставлять инновационные решения, которые реально меняют ваши бизнес-операции и прибыль.</p>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-6 zoom-in">
                        <h3 class="text-xl font-semibold mb-4" id="about-values-title-display">Наши ценности</h3>
                        <ul class="space-y-3" id="about-values-list-display">
                            </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="services" class="relative py-16 px-4 bg-gray-50 fade-in">
            <div class="section-background-image" id="services-background-image"></div>
            <div class="max-w-6xl mx-auto relative z-10 section-content-wrapper">
                <h2 id="services-title-display" class="text-3xl font-bold mb-12 text-center">Наши Услуги</h2>
                <div id="services-container" class="grid md:grid-cols-3 gap-6">
                    </div>
            </div>
        </section>

        <section id="features" class="relative py-16 px-4 bg-white fade-in">
            <div class="section-background-image" id="features-background-image"></div>
            <div class="max-w-6xl mx-auto relative z-10 section-content-wrapper">
                <h2 id="features-title-display" class="text-3xl font-bold mb-12 text-center">Ключевые Особенности</h2>
                <div id="features-container" class="space-y-8">
                    </div>
            </div>
        </section>

        <section id="testimonials" class="relative py-16 px-4 bg-blue-50 fade-in">
            <div class="section-background-image" id="testimonials-background-image"></div>
            <div class="max-w-6xl mx-auto relative z-10 section-content-wrapper">
                <h2 id="testimonials-title-display" class="text-3xl font-bold mb-12 text-center">Что говорят наши клиенты</h2>
                <div id="testimonials-container" class="grid md:grid-cols-2 gap-8">
                    </div>
            </div>
        </section>

        <section id="faq" class="relative py-16 px-4 bg-white section-hidden fade-in">
            <div class="section-background-image" id="faq-background-image"></div>
            <div class="max-w-6xl mx-auto text-center relative z-10 section-content-wrapper">
                <h2 id="faq-title-display" class="text-3xl font-bold mb-12">Часто задаваемые вопросы</h2>
                <div id="faq-container" class="space-y-4 text-left">
                    </div>
            </div>
        </section>

        <section id="contact" class="relative py-16 px-4 bg-gray-800 text-white fade-in">
            <div class="section-background-image" id="contact-background-image"></div>
            <div class="max-w-6xl mx-auto relative z-10 section-content-wrapper">
                <h2 id="contact-title-display" class="text-3xl font-bold mb-12 text-center">Свяжитесь с нами</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4" id="contact-info-title">Контактная информация</h3>
                        <p class="mb-6" id="contact-info-description">Есть вопросы или хотите узнать больше? Свяжитесь с нашей командой — мы будем рады помочь!</p>
                        <div class="space-y-4">
                            <div class="flex items-start">
                                <span class="mr-3">📧</span> <span id="display-contact-email">contact@example.com</span>
                            </div>
                            <div class="flex items-start">
                                <span class="mr-3">📞</span> <span id="display-contact-phone">+1 (555) 123-4567</span>
                            </div>
                            <div class="flex items-start">
                                <span class="mr-3">🏢</span> <span id="display-contact-address">123 Business Ave, Suite 100<br>San Francisco, CA 94107</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <form id="contact-form" class="space-y-4">
                            <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition zoom-in" id="contact-form-submit-btn">Отправить Сообщение</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="config-url-loader" class="fixed bottom-0 left-0 w-full bg-gray-900 p-4 text-white z-500 hidden">
        <div class="max-w-xl mx-auto flex items-center space-x-4">
            <label for="js-config-url-input" class="font-semibold whitespace-nowrap">URL JS Конфига:</label>
            <input type="url" id="js-config-url-input" class="flex-grow p-2 rounded text-gray-900" placeholder="Введите URL вашего JS файла конфигурации">
            <button id="load-external-js-config-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Загрузить & Применить</button>
            <button id="close-config-url-loader-btn" class="text-red-400 hover:text-red-200">✖</button>
        </div>
    </div>

    <div id="format-popup-menu" class="popup-menu hidden">
        <h4 class="font-semibold mb-2">Форматирование</h4>
        <label for="font-size-input">Размер шрифта (px):</label>
        <input type="range" id="font-size-input" min="12" max="60" step="1" value="16">
        <span id="font-size-display">16px</span>

        <label for="font-weight-select">Толщина шрифта:</label>
        <select id="font-weight-select" class="editor-input editor-select">
            <option value="normal">Обычный</option>
            <option value="medium">Средний</option>
            <option value="semibold">Полужирный</option>
            <option value="bold">Жирный</option>
            <option value="extrabold">Очень жирный</option>
        </select>

        <label for="text-align-select">Выравнивание текста:</label>
        <select id="text-align-select" class="editor-input editor-select">
            <option value="left">По левому краю</option>
            <option value="center">По центру</option>
            <option value="right">По правому краю</option>
        </select>

        <label for="text-color-picker">Цвет текста:</label>
        <input type="color" id="text-color-picker" class="editor-input h-10 p-1">

        <button id="apply-format-btn">Применить</button>
    </div>


    <script>
        // --- Объект конфигурации страницы ---
        let pageConfig ={global:{baseBgColor: '#f9fafb', // Теперь RGB
                editorPosition: 'left' // 'left' or 'right'},
            navbar:{
            visible: true,
            bgColor: '#ffffff',
            textColor: '#1f2937',
            logoText: 'ВашЛого',
            logoImageUrl: '', // Добавляем новое поле для URL изображения логотипа
            logoImageWidth: 'auto', // Ширина изображения
            logoImageHeight: '40px', // Высота изображения
                links:[{text: 'Главная', href: '#hero'},{text: 'О нас', href: '#about'},{text: 'Услуги', href: '#services'},{text: 'Особенности', href: '#features'},{text: 'Отзывы', href: '#testimonials'},{text: 'FAQ', href: '#faq'},{text: 'Контакты', href: '#contact'}]},
            hero:{    
                visible: true,
                title:{text: 'Добро пожаловать в наш потрясающий сервис', styles:{}},
                description:{text: 'Мы предлагаем лучшие решения для вашего бизнеса. Начните сегодня и увидите разницу!', styles:{}},
                buttonText:{text: 'Начать',
                    styles:{},
                    textColor: '#000000',   // цвет текста кнопки
                    bgColor: '#ffffff'      // цвет фона кнопки},
                background:{type: 'color', // 'color', 'gradient', 'image'
                    color: '#2563eb', // bg-blue-600
                    gradientClass: 'gradient-bg-1',
                    imageUrl: '',
                    imageOpacity: 1},
                textColor: '#ffffff',},
            about:{
                visible: true,
                title:{text: 'О нас', styles:{}},
                description:{text: 'Мы - команда увлеченных профессионалов, стремящихся предоставить исключительные результаты нашим клиентам. Благодаря многолетнему опыту в отрасли, мы помогли сотням компаний расти и добиваться успеха.', styles:{}},
                description2:{text: 'Наша миссия - предоставлять инновационные решения, которые реально меняют ваши бизнес-операции и прибыль.', styles:{}},
                ourValues:{title:{text: 'Наши ценности', styles:{}},
                    items:[{text: 'Клиентоориентированный подход', styles:{}},{text: 'Инновации и креативность', styles:{}},{text: 'Прозрачность и честность', styles:{}},{text: 'Постоянное совершенствование', styles:{}}]},
                bgColor: '#ffffff',
                bgImageUrl: '',
                bgImageOpacity: 1,
                textColor: '#1f2937'},
            services:{
                visible: true,
                title:{text: 'Наши Услуги', styles:{}},
                layout: 'md:grid-cols-3', // Tailwind class for grid columns
                cardPadding: 'p-6', // Tailwind class for card padding
                gap: 'gap-6', // Tailwind class for grid gap
                bgColor: '#f3f4f6', // bg-gray-50
                bgImageUrl: '',
                bgImageOpacity: 1,
                textColor: '#1f2937',
                items:[{icon: '🛠️', iconUrl: '', title:{text: 'Разработка ПО', styles:{}}, description:{text: 'Комплексные решения для разработки программного обеспечения на заказ.', styles:{}}},{icon: '📈', iconUrl: '', title:{text: 'Маркетинг', styles:{}}, description:{text: 'Стратегии цифрового маркетинга для увеличения вашего присутствия в Интернете.', styles:{}}},{icon: '🔒', iconUrl: '', title:{text: 'Консалтинг', styles:{}}, description:{text: 'Экспертные консультации по оптимизации бизнес-процессов.', styles:{}}},{icon: '🌐', iconUrl: '', title:{text: 'Веб-дизайн', styles:{}}, description:{text: 'Создание адаптивных и привлекательных веб-сайтов.', styles:{}}}]},
            features:{
                visible: true,
                title:{text: 'Ключевые Особенности', styles:{}},
                bgColor: '#ffffff',
                bgImageUrl: '',
                bgImageOpacity: 1,
                textColor: '#1f2937',
                items:[{icon: '📊', iconUrl: '', title:{text: 'Аналитика Данных', styles:{}}, description:{text: 'Получите глубокие знания с помощью мощных инструментов анализа данных.', styles:{}}},{icon: '⚡', iconUrl: '', title:{text: 'Высокая Производительность', styles:{}}, description:{text: 'Ощутите молниеносную скорость и бесперебойную работу.', styles:{}}},{icon: '🔗', iconUrl: '', title:{text: 'Бесшовная Интеграция', styles:{}}, description:{text: 'Легко подключайтесь к вашей существующей программной экосистеме.', styles:{}}},{icon: '💡', iconUrl: '', title:{text: 'Инновационный Дизайн', styles:{}}, description:{text: 'Современный и интуитивно понятный дизайн для лучшего пользовательского опыта.', styles:{}}}]},
            testimonials:{
                visible: true,
                title:{text: 'Что говорят наши клиенты', styles:{}},
                bgColor: '#eff6ff', // bg-blue-50
                bgImageUrl: '',
                bgImageOpacity: 1,
                textColor: '#1f2937',
                items:[{avatar: 'ИИ', avatarUrl: '', name:{text: 'Иван Иванов', styles:{}}, position:{text: 'Генеральный директор, ООО "Компания"', styles:{}}, quote:{text: 'Этот сервис полностью изменил наши операции. Команда была профессиональной, отзывчивой и превзошла наши ожидания.', styles:{}}},{avatar: 'ЕС', avatarUrl: '', name:{text: 'Елена Смирнова', styles:{}}, position:{text: 'Директор по маркетингу', styles:{}}, quote:{text: 'Результаты, которые мы увидели всего за три месяца, невероятны. Их инновационный подход решил проблемы, о которых мы даже не знали!', styles:{}}},{avatar: 'ДА', avatarUrl: '', name:{text: 'Дмитрий Алексеев', styles:{}}, position:{text: 'Владелец малого бизнеса', styles:{}}, quote:{text: 'Очень доволен качеством услуг и поддержкой. Рекомендую всем!', styles:{}}}]},
            faq:{
                visible: true,
                title:{text: 'Часто задаваемые вопросы', styles:{}},
                bgColor: '#ffffff',
                bgImageUrl: '',
                bgImageOpacity: 1,
                textColor: '#1f2937',
                items:[{question:{text: 'Какова ваша модель ценообразования?', styles:{}}, answer:{text: 'Наше ценообразование гибкое и зависит от ваших конкретных потребностей. Пожалуйста, свяжитесь с нами для получения индивидуального предложения.', styles:{}}},{question:{text: 'Вы предлагаете бесплатный пробный период?', styles:{}}, answer:{text: 'Да, мы предлагаем 14-дневный бесплатный пробный период с полным доступом ко всем функциям. Кредитная карта не требуется!', styles:{}}},{question:{text: 'Могу ли я настроить дизайн?', styles:{}}, answer:{text: 'Да, вы можете настроить практически каждый аспект дизайна с помощью нашего удобного редактора.', styles:{}}},{question:{text: 'Какая у вас поддержка клиентов?', styles:{}}, answer:{text: 'Мы предоставляем круглосуточную поддержку клиентов по электронной почте, телефону и через онлайн-чат.', styles:{}}}]},
            contact:{
                visible: true,
                title:{text: 'Свяжитесь с нами', styles:{}},
                bgColor: '#1f2937', // bg-gray-800
                bgImageUrl: '',
                bgImageOpacity: 1,
                textColor: '#ffffff',
                info:{email:{text: 'contact@example.com', styles:{}},
                    phone:{text: '+1 (555) 123-4567', styles:{}},
                    address:{text: '123 Business Ave, Suite 100\nSan Francisco, CA 94107', styles:{}}},
              infoBlock:{title:{text: 'Контактная информация', styles:{}},
                description:{text: 'Есть вопросы или хотите узнать больше? Свяжитесь с нашей командой — мы будем рады помочь!', styles:{}}},

                form:{fields:[{id: 'contact-name', label:{text: 'Ваше Имя', styles:{}}, type: 'text', required: true, imageUrl: '', imageWidth: 24, imageHeight: 24, placeholder:{text: 'Введите ваше имя', color: '#a1a1a1'}},{id: 'contact-email', label:{text: 'Ваш Email', styles:{}}, type: 'email', required: true, imageUrl: '', imageWidth: 24, imageHeight: 24, placeholder:{text: 'Введите ваш email', color: '#a1a1a1'}},{id: 'contact-phone', label:{text: 'Ваш Телефон (необязательно)', styles:{}}, type: 'tel', required: false, imageUrl: '', imageWidth: 24, imageHeight: 24, placeholder:{text: 'Введите ваш телефон', color: '#a1a1a1'}},{id: 'contact-message', label:{text: 'Ваше Сообщение', styles:{}}, type: 'textarea', required: true, rows: 4, imageUrl: '', imageWidth: 24, imageHeight: 24, placeholder:{text: 'Введите ваше сообщение', color: '#a1a1a1'}}],
                    submitButtonText:{text: 'Отправить Сообщение', styles:{}}}}};

        // --- Утилиты для преобразования цвета ---
        function hexToRgbA(hex, alpha = 1){let c;
            if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){c= hex.substring(1).split('');
                if(c.length===3){c=[c[0], c[0], c[1], c[1], c[2], c[2]];}c= '0x'+c.join('');
                return `rgba(${[(c>>16)&255, (c>>8)&255, c&255].join(',')},${alpha})`;}return hex; // Return as is if not a valid hex, or already rgba}// --- Основные функции для рендеринга страницы ---
        function applyStyles(element, styles){if (!element || !styles) return;

            if (styles.fontSize) element.style.fontSize = styles.fontSize;
            if (styles.fontWeight) element.style.fontWeight = styles.fontWeight;
            if (styles.textAlign) element.style.textAlign = styles.textAlign;
            if (styles.color) element.style.color = styles.color;}function updatePreview(){// Глобальные настройки
            document.body.style.backgroundColor = pageConfig.global.baseBgColor;
            document.getElementById('about-description-2-display').textContent = pageConfig.about.description2.text;
            applyStyles(document.getElementById('about-description-2-display'), pageConfig.about.description2.styles);

// Панель навигации
const navbar = document.getElementById('navbar');
const navLinksContainer = document.getElementById('nav-links');
const navbarLogo = document.getElementById('navbar-logo');
navbar.style.backgroundColor = pageConfig.navbar.bgColor;
navbar.style.color = pageConfig.navbar.textColor;

// Обновляем логотип
if (!navbarLogo){const logoDiv = document.createElement('div');
    logoDiv.id = 'navbar-logo';
    logoDiv.className = 'text-2xl font-bold';
    navbar.insertBefore(logoDiv, navLinksContainer);}const logoDiv = document.getElementById('navbar-logo');
logoDiv.innerHTML = ''; // Очищаем содержимое

if (pageConfig.navbar.logoImageUrl){// Если есть URL изображения, показываем изображение
    const logoImg = document.createElement('img');
    logoImg.src = pageConfig.navbar.logoImageUrl;
    logoImg.alt = pageConfig.navbar.logoText || 'Логотип';
    logoImg.style.width = pageConfig.navbar.logoImageWidth;
    logoImg.style.height = pageConfig.navbar.logoImageHeight;
    logoImg.style.objectFit = 'contain';
    logoDiv.appendChild(logoImg);}else{// Если нет изображения, показываем текст
    logoDiv.textContent = pageConfig.navbar.logoText;
    logoDiv.style.color = pageConfig.navbar.textColor;}// Остальной код для навигационных ссылок остается без изменений
navLinksContainer.innerHTML = '';
pageConfig.navbar.links.forEach(link =>{const li = document.createElement('li');
    const a = document.createElement('a');
    a.href = link.href;
    a.textContent = link.text;
    a.className = `hover:text-blue-600`;
    a.style.color = pageConfig.navbar.textColor;
    li.appendChild(a);
    navLinksContainer.appendChild(li);});

            // Видимость секций и эффект появления (повторное применение при изменении контента)
            for (const sectionKey in pageConfig){if (pageConfig.hasOwnProperty(sectionKey) && document.getElementById(sectionKey)){const section = document.getElementById(sectionKey);
                    if (pageConfig[sectionKey].visible){section.classList.remove('section-hidden');
                        section.classList.add('fade-in'); // Повторное применение fade-in}else{section.classList.add('section-hidden');
                        section.classList.remove('fade-in');}}}// Секция "Герой"
            const heroSection = document.getElementById('hero');
            const heroBackgroundDiv = document.getElementById('hero-background-image');
            if (pageConfig.hero.visible){document.getElementById('hero-title').textContent = pageConfig.hero.title.text;
                applyStyles(document.getElementById('hero-title'), pageConfig.hero.title.styles);

                document.getElementById('hero-description').textContent = pageConfig.hero.description.text;
                applyStyles(document.getElementById('hero-description'), pageConfig.hero.description.styles);

                const heroBtn = document.getElementById('hero-button');
                heroBtn.textContent = pageConfig.hero.buttonText.text;
                applyStyles(heroBtn, pageConfig.hero.buttonText.styles);
                heroBtn.style.color = pageConfig.hero.buttonText.textColor;
                heroBtn.style.backgroundColor = pageConfig.hero.buttonText.bgColor;



                // Сброс стилей секции "Герой"
                heroSection.classList.remove(...Array.from(heroSection.classList).filter(c => c.startsWith('bg-') || c.startsWith('gradient-bg-')));
                heroSection.style.backgroundColor = '';
                heroBackgroundDiv.style.backgroundImage = 'none';
                heroBackgroundDiv.style.display = 'none';

                heroSection.style.color = pageConfig.hero.textColor;

                if (pageConfig.hero.background.type === 'color'){heroSection.style.backgroundColor = pageConfig.hero.background.color;}else if (pageConfig.hero.background.type === 'gradient'){heroSection.classList.add(pageConfig.hero.background.gradientClass);}else if (pageConfig.hero.background.type === 'image'){heroBackgroundDiv.style.backgroundImage = `url('${pageConfig.hero.background.imageUrl}')`;
                    heroBackgroundDiv.style.display = 'block';
                    heroBackgroundDiv.style.opacity = pageConfig.hero.background.imageOpacity;}}// Рендеринг секций с общим фоном и цветом текста['about', 'services', 'features', 'testimonials', 'faq', 'contact'].forEach(sectionKey =>{const section = document.getElementById(sectionKey);
                const sectionBgImageDiv = document.getElementById(`${sectionKey}-background-image`);
                if (pageConfig[sectionKey]&& pageConfig[sectionKey].visible){section.style.backgroundColor = pageConfig[sectionKey].bgColor;
                    section.style.color = pageConfig[sectionKey].textColor;

                    if (pageConfig[sectionKey].bgImageUrl){sectionBgImageDiv.style.backgroundImage = `url('${pageConfig[sectionKey].bgImageUrl}')`;
                        sectionBgImageDiv.style.display = 'block';
                        sectionBgImageDiv.style.opacity = pageConfig[sectionKey].bgImageOpacity;}else{sectionBgImageDiv.style.backgroundImage = 'none';
                        sectionBgImageDiv.style.display = 'none';}// Обновление заголовков секций
                    if (document.getElementById(`${sectionKey}-title-display`)){document.getElementById(`${sectionKey}-title-display`).textContent = pageConfig[sectionKey].title.text;
                        applyStyles(document.getElementById(`${sectionKey}-title-display`), pageConfig[sectionKey].title.styles);}}});


            // Секция "О нас" (дополнительные элементы)
            if (pageConfig.about.visible){document.getElementById('about-description-1-display').textContent = pageConfig.about.description.text;
                applyStyles(document.getElementById('about-description-1-display'), pageConfig.about.description.styles);
               document.getElementById('about-description-2-display').textContent = pageConfig.about.description2.text;
                document.getElementById('about-values-title-display').textContent = pageConfig.about.ourValues.title.text;
                applyStyles(document.getElementById('about-values-title-display'), pageConfig.about.ourValues.title.styles);

                const valuesList = document.getElementById('about-values-list-display');
                valuesList.innerHTML = '';
                pageConfig.about.ourValues.items.forEach(value =>{const li = document.createElement('li');
                    li.className = 'flex items-start';
                    li.innerHTML = `<span class="text-blue-600 mr-2">✓</span><span id="about-value-${value.text.replace(/\s+/g, '-')}" style="${getStyleString(value.styles)}">${value.text}</span>`;
                    valuesList.appendChild(li);});}// Секция "Услуги" (дополнительные элементы)
            if (pageConfig.services.visible){const servicesContainer = document.getElementById('services-container');
                servicesContainer.className = `grid ${pageConfig.services.layout}${pageConfig.services.gap}`;
                servicesContainer.innerHTML = '';
                pageConfig.services.items.forEach((service, index) =>{const serviceDiv = document.createElement('div');
                    serviceDiv.className = `bg-white ${pageConfig.services.cardPadding}rounded-lg shadow-sm hover:shadow-md transition zoom-in`;
                    serviceDiv.style.color = pageConfig.services.textColor; // Цвет текста карточек
                    let iconHtml = '';
                    if (service.iconUrl){iconHtml = `<img src="${service.iconUrl}" alt="${service.title.text}icon" class="w-12 h-12 mb-4 text-blue-600">`;}else{iconHtml = `<div class="text-blue-600 text-4xl mb-4">${service.icon}</div>`;}serviceDiv.innerHTML = `
                        ${iconHtml}<h3 class="text-xl font-semibold mb-3" id="service-${index}-title" style="${getStyleString(service.title.styles)}">${service.title.text}</h3>
                        <p class="text-gray-600" id="service-${index}-description" style="${getStyleString(service.description.styles)}">${service.description.text}</p>
                    `;
                    servicesContainer.appendChild(serviceDiv);});}// Секция "Особенности" (дополнительные элементы)
            if (pageConfig.features.visible){const featuresContainer = document.getElementById('features-container');
                featuresContainer.innerHTML = '';
                pageConfig.features.items.forEach((feature, index) =>{const featureDiv = document.createElement('div');
                    featureDiv.className = `flex flex-col md:flex-row gap-6 items-center p-6 bg-gray-50 rounded-lg shadow-sm zoom-in`;
                    featureDiv.style.color = pageConfig.features.textColor; // Цвет текста карточек
                    let iconHtml = '';
                    if (feature.iconUrl){iconHtml = `<img src="${feature.iconUrl}" alt="${feature.title.text}icon" class="w-16 h-16 md:w-20 md:h-20 mb-4 md:mb-0 md:mr-6 flex-shrink-0">`;}else{iconHtml = `<div class="text-6xl mb-4 md:mb-0 md:mr-6 flex-shrink-0">${feature.icon}</div>`;}featureDiv.innerHTML = `
                        ${iconHtml}<div>
                            <h3 class="text-2xl font-semibold mb-2" id="feature-${index}-title" style="${getStyleString(feature.title.styles)}">${feature.title.text}</h3>
                            <p class="text-gray-600" id="feature-${index}-description" style="${getStyleString(feature.description.styles)}">${feature.description.text}</p>
                        </div>
                    `;
                    featuresContainer.appendChild(featureDiv);});}// Секция "Отзывы" (дополнительные элементы)
            if (pageConfig.testimonials.visible){const testimonialsContainer = document.getElementById('testimonials-container');
                testimonialsContainer.innerHTML = '';
                pageConfig.testimonials.items.forEach((testimonial, index) =>{const testimonialDiv = document.createElement('div');
                    testimonialDiv.className = `bg-white p-6 rounded-lg shadow-md zoom-in`;
                    testimonialDiv.style.color = pageConfig.testimonials.textColor; // Цвет текста карточек
                    let avatarHtml = '';
                    if (testimonial.avatarUrl){avatarHtml = `<img src="${testimonial.avatarUrl}" alt="${testimonial.name.text}avatar" class="w-16 h-16 rounded-full mr-4 object-cover">`;}else{avatarHtml = `<div class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-xl font-bold mr-4">${testimonial.avatar}</div>`;}testimonialDiv.innerHTML = `
                        <div class="flex items-center mb-4">
                            ${avatarHtml}<div>
                                <h3 class="font-semibold text-lg" id="testimonial-${index}-name" style="${getStyleString(testimonial.name.styles)}">${testimonial.name.text}</h3>
                                <p class="text-sm text-gray-500" id="testimonial-${index}-position" style="${getStyleString(testimonial.position.styles)}">${testimonial.position.text}</p>
                            </div>
                        </div>
                        <p class="text-gray-700 leading-relaxed" id="testimonial-${index}-quote" style="${getStyleString(testimonial.quote.styles)}">"${testimonial.quote.text}"</p>
                    `;
                    testimonialsContainer.appendChild(testimonialDiv);});}// Секция "Часто задаваемые вопросы" (дополнительные элементы)
            if (pageConfig.faq.visible){const faqContainer = document.getElementById('faq-container');
                faqContainer.innerHTML = '';
                pageConfig.faq.items.forEach((item, index) =>{const faqItem = document.createElement('div');
                    faqItem.className = 'border-b border-gray-200 py-4 cursor-pointer';
                    faqItem.innerHTML = `
                        <div class="flex justify-between items-center text-lg font-semibold text-gray-800" onclick="this.nextElementSibling.classList.toggle('hidden')">
                            <span id="faq-${index}-question" style="${getStyleString(item.question.styles)}">${item.question.text}</span>
                            <span class="text-gray-500 text-xl">+</span>
                        </div>
                        <div class="text-gray-600 mt-2 hidden" id="faq-${index}-answer" style="${getStyleString(item.answer.styles)}">${item.answer.text}</div>
                    `;
                    faqContainer.appendChild(faqItem);});}// Секция "Контакты" (дополнительные элементы)
            if (pageConfig.contact.visible){document.getElementById('contact-info-title').textContent = pageConfig.contact.infoBlock.title.text;
                applyStyles(document.getElementById('contact-info-title'), pageConfig.contact.infoBlock.title.styles);

                document.getElementById('contact-info-description').textContent = pageConfig.contact.infoBlock.description.text;
                applyStyles(document.getElementById('contact-info-description'), pageConfig.contact.infoBlock.description.styles);

                document.getElementById('display-contact-email').textContent = pageConfig.contact.info.email.text;
                applyStyles(document.getElementById('display-contact-email'), pageConfig.contact.info.email.styles);

                document.getElementById('display-contact-phone').textContent = pageConfig.contact.info.phone.text;
                applyStyles(document.getElementById('display-contact-phone'), pageConfig.contact.info.phone.styles);

                document.getElementById('display-contact-address').innerHTML = pageConfig.contact.info.address.text.replace(/\n/g, '<br>');
                applyStyles(document.getElementById('display-contact-address'), pageConfig.contact.info.address.styles);

                const contactForm = document.getElementById('contact-form');
                // Очистить все, кроме кнопки submit
                Array.from(contactForm.children).forEach(child =>{if (child.id !== 'contact-form-submit-btn'){child.remove();}});

                // Вставить поля перед кнопкой submit
                pageConfig.contact.form.fields.forEach(field =>{const fieldDiv = document.createElement('div');
                    fieldDiv.className = 'mb-4';
                    let inputElement;
                    if (field.type === 'textarea'){inputElement = `<textarea id="${field.id}" class="w-full px-4 py-2 rounded text-gray-800 focus:ring-blue-500 focus:border-blue-500" rows="${field.rows}" ${field.required ? 'required' : ''}placeholder="${field.placeholder.text}"></textarea>`;}else{inputElement = `<input type="${field.type}" id="${field.id}" class="w-full px-4 py-2 rounded text-gray-800 focus:ring-blue-500 focus:border-blue-500" ${field.required ? 'required' : ''}placeholder="${field.placeholder.text}">`;}let imageHtml = '';
                    if (field.imageUrl){imageHtml = `<img src="${field.imageUrl}" alt="${field.label.text}icon" style="width: ${field.imageWidth}px; height: ${field.imageHeight}px; margin-right: 8px;">`;}fieldDiv.innerHTML = `
                        <label for="${field.id}" class="block mb-1 ${pageConfig.contact.textColor === '#ffffff' ? 'text-white' : 'text-gray-800'}flex items-center" id="${field.id}-label-display" style="${getStyleString(field.label.styles)}">${imageHtml}${field.label.text}</label>
                        ${inputElement}`;
                    contactForm.insertBefore(fieldDiv, document.getElementById('contact-form-submit-btn'));

                    // Применение цвета плейсхолдера через CSS
                    const inputOrTextarea = fieldDiv.querySelector(`#${field.id}`);
                    if (inputOrTextarea && field.placeholder.color){inputOrTextarea.style.setProperty('--tw-placeholder-opacity', '1'); // Убедиться, что TailwindCSS не мешает opacity
                        inputOrTextarea.style.setProperty('color', pageConfig.contact.textColor); // Установить цвет текста ввода
                        inputOrTextarea.style.setProperty('--placeholder-color', field.placeholder.color);
                        inputOrTextarea.style.setProperty('::placeholder', `color: var(--placeholder-color)`);
                        inputOrTextarea.style.setProperty('-webkit-input-placeholder', `color: var(--placeholder-color)`);
                        inputOrTextarea.style.setProperty('-moz-placeholder', `color: var(--placeholder-color)`);
                        inputOrTextarea.style.setProperty('-ms-input-placeholder', `color: var(--placeholder-color)`);

                        // Дополнительно, чтобы placeholder работал со стилями
                        let styleTag = document.getElementById('placeholder-styles');
                        if (!styleTag){styleTag = document.createElement('style');
                            styleTag.id = 'placeholder-styles';
                            document.head.appendChild(styleTag);}const cssRule = `#${field.id}::placeholder{color: ${field.placeholder.color}!important;}`;
                        const mozRule = `#${field.id}:-moz-placeholder{color: ${field.placeholder.color}!important;}`;
                        const webkitRule = `#${field.id}::-webkit-input-placeholder{color: ${field.placeholder.color}!important;}`;
                        const msRule = `#${field.id}:-ms-input-placeholder{color: ${field.placeholder.color}!important;}`;
                        styleTag.innerHTML += cssRule + mozRule + webkitRule + msRule;}});

                document.getElementById('contact-form-submit-btn').textContent = pageConfig.contact.form.submitButtonText.text;
                applyStyles(document.getElementById('contact-form-submit-btn'), pageConfig.contact.form.submitButtonText.styles);}// Контактная информация
const infoTitle = document.getElementById("contact-info-title");
const infoDesc = document.getElementById("contact-info-description");
if (infoTitle && infoDesc){infoTitle.textContent = pageConfig.contact.infoBlock.title.text;
  applyStyles(infoTitle, pageConfig.contact.infoBlock.title.styles);
  infoDesc.textContent = pageConfig.contact.infoBlock.description.text;
  applyStyles(infoDesc, pageConfig.contact.infoBlock.description.styles);}// Кнопка Hero
const heroBtn = document.getElementById("hero-button");
if (heroBtn){heroBtn.textContent = pageConfig.hero.buttonText.text;
  applyStyles(heroBtn, pageConfig.hero.buttonText.styles);
  heroBtn.style.color = pageConfig.hero.buttonText.textColor;
  heroBtn.style.backgroundColor = pageConfig.hero.buttonText.bgColor;}}// Вспомогательная функция для генерации строкового представления стилей
        function getStyleString(styles){let styleString = '';
            for (const key in styles){if (styles.hasOwnProperty(key)){// Преобразование camelCase в kebab-case для CSS свойств
                    const cssProperty = key.replace(/([A-Z])/g, '-$1').toLowerCase();
                    styleString += `${cssProperty}: ${styles[key]}; `;}}return styleString;}// --- Управление пользовательским интерфейсом редактора ---
        let currentTargetElementId = null; // Для отслеживания элемента, который форматируется

        function toggleEditor(){document.getElementById('editor-drawer').classList.toggle('open');}function setEditorPosition(position){const drawer = document.getElementById('editor-drawer');
            const toggleBtn = document.getElementById('editor-toggle');
            if (position === 'left'){drawer.classList.remove('right');
                toggleBtn.style.left = 'auto';
                toggleBtn.style.right = '-45px';
                toggleBtn.style.borderRadius = '0 8px 8px 0';
                toggleBtn.style.boxShadow = '2px 0 8px rgba(0,0,0,0.15)';}else{// position === 'right'
                drawer.classList.add('right');
                toggleBtn.style.left = '-45px';
                toggleBtn.style.right = 'auto';
                toggleBtn.style.borderRadius = '8px 0 0 8px';
                toggleBtn.style.boxShadow = '-2px 0 8px rgba(0,0,0,0.15)';}pageConfig.global.editorPosition = position;}function populateEditorUI(){// Глобальные настройки
            document.getElementById('global-bg').value = pageConfig.global.baseBgColor;
            setEditorPosition(pageConfig.global.editorPosition);
document.getElementById('about-desc2-input').value = pageConfig.about.description2.text;

            // Навигационная панель
            document.getElementById('nav-bg-color').value = pageConfig.navbar.bgColor;
            document.getElementById('nav-text-color').value = pageConfig.navbar.textColor;
// Навигационная панель
document.getElementById('nav-bg-color').value = pageConfig.navbar.bgColor;
document.getElementById('nav-text-color').value = pageConfig.navbar.textColor;
document.getElementById('navbar-logo-text').value = pageConfig.navbar.logoText;
document.getElementById('navbar-logo-image-url').value = pageConfig.navbar.logoImageUrl;
document.getElementById('navbar-logo-image-width').value = pageConfig.navbar.logoImageWidth;
document.getElementById('navbar-logo-image-height').value = pageConfig.navbar.logoImageHeight;
            renderNavbarLinksEditor();

            // Переключатели секций (чекбоксы)
            document.querySelectorAll('.section-editor-block').forEach(block =>{const sectionKey = block.dataset.section;
                const content = block.querySelector('.section-editor-content');
                const header = block.querySelector('.section-editor-header');
                const arrow = header.querySelector('.accordion-arrow');

                if (sectionKey !== 'global'){// Глобальная секция не имеет чекбокса
                    const checkbox = block.querySelector('.section-toggle');
                    checkbox.checked = pageConfig[sectionKey].visible;
                    // Изначально скрыть/показать содержимое на основе видимости
                    content.classList.toggle('hidden', !pageConfig[sectionKey].visible);
                    header.classList.toggle('collapsed', !pageConfig[sectionKey].visible);
                    arrow.classList.toggle('rotate', pageConfig[sectionKey].visible);}else{// Для глобальной секции, всегда развернута по умолчанию
                    content.classList.remove('hidden');
                    header.classList.remove('collapsed');
                    arrow.classList.add('rotate');}// Если секция скрыта, также скрыть ее блок содержимого
                if (sectionKey !== 'global' && !pageConfig[sectionKey].visible){block.classList.add('hidden');}else{block.classList.remove('hidden');}});

            // Секция "Герой"
            document.getElementById('hero-title-input').value = pageConfig.hero.title.text;
            document.getElementById('hero-desc-input').value = pageConfig.hero.description.text;
            document.getElementById('hero-btn-text-input').value = pageConfig.hero.buttonText.text;
            document.getElementById('hero-bg-type-select').value = pageConfig.hero.background.type;
            document.getElementById('hero-bg-color-picker').value = pageConfig.hero.background.color;
            document.getElementById('hero-gradient-select').value = pageConfig.hero.background.gradientClass;
            document.getElementById('hero-image-url-input').value = pageConfig.hero.background.imageUrl;
            document.getElementById('hero-image-opacity-input').value = pageConfig.hero.background.imageOpacity;
            document.getElementById('hero-text-color-picker').value = pageConfig.hero.textColor;
            // Цвета кнопки
document.getElementById('hero-button-text-color-picker').value = pageConfig.hero.buttonText.textColor;
document.getElementById('hero-button-bg-color-picker').value = pageConfig.hero.buttonText.bgColor;
            document.getElementById('hero-bg-type-select').dispatchEvent(new Event('change')); // Вызвать событие change для обновления видимости опций фона

            // Секция "О нас"
            document.getElementById('about-title-input').value = pageConfig.about.title.text;
            document.getElementById('about-desc-input').value = pageConfig.about.description.text;
            document.getElementById('about-values-title-input').value = pageConfig.about.ourValues.title.text;
            document.getElementById('about-bg-color-picker').value = pageConfig.about.bgColor;
            document.getElementById('about-bg-image-url-input').value = pageConfig.about.bgImageUrl;
            document.getElementById('about-bg-image-opacity-input').value = pageConfig.about.bgImageOpacity;
            document.getElementById('about-text-color-picker').value = pageConfig.about.textColor;
            renderAboutValuesEditor();

            // Секция "Услуги"
            document.getElementById('services-title-input').value = pageConfig.services.title.text;
            document.getElementById('services-layout-select').value = pageConfig.services.layout;
            document.getElementById('services-card-padding-select').value = pageConfig.services.cardPadding;
            document.getElementById('services-gap-select').value = pageConfig.services.gap;
            document.getElementById('services-bg-color-picker').value = pageConfig.services.bgColor;
            document.getElementById('services-bg-image-url-input').value = pageConfig.services.bgImageUrl;
            document.getElementById('services-bg-image-opacity-input').value = pageConfig.services.bgImageOpacity;
            document.getElementById('services-text-color-picker').value = pageConfig.services.textColor;
            renderServicesEditor();

            // Секция "Особенности"
            document.getElementById('features-title-input').value = pageConfig.features.title.text;
            document.getElementById('features-bg-color-picker').value = pageConfig.features.bgColor;
            document.getElementById('features-bg-image-url-input').value = pageConfig.features.bgImageUrl;
            document.getElementById('features-bg-image-opacity-input').value = pageConfig.features.bgImageOpacity;
            document.getElementById('features-text-color-picker').value = pageConfig.features.textColor;
            renderFeaturesEditor();

            // Секция "Отзывы"
            document.getElementById('testimonials-title-input').value = pageConfig.testimonials.title.text;
            document.getElementById('testimonials-bg-color-picker').value = pageConfig.testimonials.bgColor;
            document.getElementById('testimonials-bg-image-url-input').value = pageConfig.testimonials.bgImageUrl;
            document.getElementById('testimonials-bg-image-opacity-input').value = pageConfig.testimonials.bgImageOpacity;
            document.getElementById('testimonials-text-color-picker').value = pageConfig.testimonials.textColor;
            renderTestimonialsEditor();

            // Секция "Часто задаваемые вопросы"
            document.getElementById('faq-title-input').value = pageConfig.faq.title.text;
            document.getElementById('faq-bg-color-picker').value = pageConfig.faq.bgColor;
            document.getElementById('faq-bg-image-url-input').value = pageConfig.faq.bgImageUrl;
            document.getElementById('faq-bg-image-opacity-input').value = pageConfig.faq.bgImageOpacity;
            document.getElementById('faq-text-color-picker').value = pageConfig.faq.textColor;
            renderFAQEditor();

            // Секция "Контакты"
            document.getElementById('contact-title-input').value = pageConfig.contact.title.text;
            document.getElementById('contact-bg-color-picker').value = pageConfig.contact.bgColor;
            document.getElementById('contact-bg-image-url-input').value = pageConfig.contact.bgImageUrl;
            document.getElementById('contact-bg-image-opacity-input').value = pageConfig.contact.bgImageOpacity;
            document.getElementById('contact-text-color-picker').value = pageConfig.contact.textColor;
            document.getElementById('contact-email-input').value = pageConfig.contact.info.email.text;
            document.getElementById('contact-phone-input').value = pageConfig.contact.info.phone.text;
            document.getElementById('contact-address-input').value = pageConfig.contact.info.address.text;
            document.getElementById('submit-btn-text-input').value = pageConfig.contact.form.submitButtonText.text;
            document.getElementById('contact-info-title-input').value = pageConfig.contact.infoBlock.title.text;
            document.getElementById('contact-info-description-input').value = pageConfig.contact.infoBlock.description.text;
            renderContactFormEditor();}// --- Функции рендеринга для динамических списков в Редакторе ---

        function renderNavbarLinksEditor(){const linksListDiv = document.getElementById('navbar-links-editor');
            linksListDiv.innerHTML = '';
            pageConfig.navbar.links.forEach((link, index) =>{const linkDiv = document.createElement('div');
                linkDiv.className = 'flex items-center space-x-2 relative';
                linkDiv.innerHTML = `
                    <button class="remove-item-btn" data-index="${index}" data-type="navbar-link">×</button>
                    <label class="editor-label">Текст:</label>
                    <input type="text" class="editor-input navbar-link-text-input flex-grow" data-index="${index}" value="${link.text}">
                    <label class="editor-label">Цель (ID секции):</label>
                    <input type="text" class="editor-input navbar-link-href-input flex-grow" data-index="${index}" value="${link.href}">
                `;
                linksListDiv.appendChild(linkDiv);});
            addEventListenersToDynamicItems();}function renderAboutValuesEditor(){const valuesListDiv = document.getElementById('about-values-editor-list');
            valuesListDiv.innerHTML = '';
            pageConfig.about.ourValues.items.forEach((value, index) =>{const valueDiv = document.createElement('div');
                valueDiv.className = 'flex items-center space-x-2 relative input-with-controls';
                valueDiv.innerHTML = `
                    <button class="remove-item-btn" data-index="${index}" data-type="about-value">×</button>
                    <input type="text" class="editor-input about-value-input flex-grow" data-index="${index}" value="${value.text}">
                    <button class="format-menu-btn" data-target-section="about" data-target-path="ourValues.items.${index}.text">⋮</button>
                `;
                valuesListDiv.appendChild(valueDiv);});
            addEventListenersToDynamicItems();}function renderServicesEditor(){const servicesListDiv = document.getElementById('services-list-editor');
            servicesListDiv.innerHTML = '';
            pageConfig.services.items.forEach((service, index) =>{const serviceDiv = document.createElement('div');
                serviceDiv.className = 'border border-gray-300 p-3 rounded-md space-y-2 relative bg-white';
                serviceDiv.innerHTML = `
                    <button class="remove-item-btn" data-index="${index}" data-type="service">×</button>
                    <label class="editor-label">Заголовок</label>
                    <div class="input-with-controls">
                        <input type="text" class="editor-input service-title-input" data-index="${index}" value="${service.title.text}">
                        <button class="format-menu-btn" data-target-section="services" data-target-path="items.${index}.title.text">⋮</button>
                    </div>
                    <label class="editor-label">Описание</label>
                    <div class="input-with-controls">
                        <textarea class="editor-input editor-textarea service-description-input" data-index="${index}" rows="2">${service.description.text}</textarea>
                        <button class="format-menu-btn" data-target-section="services" data-target-path="items.${index}.description.text">⋮</button>
                    </div>
                    <label class="editor-label">Иконка (Эмодзи)</label>
                    <input type="text" class="editor-input service-icon-input" data-index="${index}" value="${service.icon}">
                    <label class="editor-label">URL иконки (необязательно)</label>
                    <input type="text" class="editor-input service-icon-url-input" data-index="${index}" value="${service.iconUrl}" placeholder="Или URL изображения/SVG">
                `;
                servicesListDiv.appendChild(serviceDiv);});
            addEventListenersToDynamicItems();}function renderFeaturesEditor(){const featuresListDiv = document.getElementById('features-list-editor');
            featuresListDiv.innerHTML = '';
            pageConfig.features.items.forEach((feature, index) =>{const featureDiv = document.createElement('div');
                featureDiv.className = 'border border-gray-300 p-3 rounded-md space-y-2 relative bg-white';
                featureDiv.innerHTML = `
                    <button class="remove-item-btn" data-index="${index}" data-type="feature">×</button>
                    <label class="editor-label">Заголовок</label>
                    <div class="input-with-controls">
                        <input type="text" class="editor-input feature-title-input" data-index="${index}" value="${feature.title.text}">
                        <button class="format-menu-btn" data-target-section="features" data-target-path="items.${index}.title.text">⋮</button>
                    </div>
                    <label class="editor-label">Описание</label>
                    <div class="input-with-controls">
                        <textarea class="editor-input editor-textarea feature-description-input" data-index="${index}" rows="2">${feature.description.text}</textarea>
                        <button class="format-menu-btn" data-target-section="features" data-target-path="items.${index}.description.text">⋮</button>
                    </div>
                    <label class="editor-label">Иконка (Эмодзи)</label>
                    <input type="text" class="editor-input feature-icon-input" data-index="${index}" value="${feature.icon}">
                    <label class="editor-label">URL иконки (необязательно)</label>
                    <input type="text" class="editor-input feature-icon-url-input" data-index="${index}" value="${feature.iconUrl}" placeholder="Или URL изображения/SVG">
                `;
                featuresListDiv.appendChild(featureDiv);});
            addEventListenersToDynamicItems();}function renderTestimonialsEditor(){const testimonialsListDiv = document.getElementById('testimonials-list-editor');
            testimonialsListDiv.innerHTML = '';
            pageConfig.testimonials.items.forEach((testimonial, index) =>{const testimonialDiv = document.createElement('div');
                testimonialDiv.className = 'border border-gray-300 p-3 rounded-md space-y-2 relative bg-white';
                testimonialDiv.innerHTML = `
                    <button class="remove-item-btn" data-index="${index}" data-type="testimonial">×</button>
                    <label class="editor-label">Имя</label>
                    <div class="input-with-controls">
                        <input type="text" class="editor-input testimonial-name-input" data-index="${index}" value="${testimonial.name.text}">
                        <button class="format-menu-btn" data-target-section="testimonials" data-target-path="items.${index}.name.text">⋮</button>
                    </div>
                    <label class="editor-label">Должность</label>
                    <div class="input-with-controls">
                        <input type="text" class="editor-input testimonial-position-input" data-index="${index}" value="${testimonial.position.text}">
                        <button class="format-menu-btn" data-target-section="testimonials" data-target-path="items.${index}.position.text">⋮</button>
                    </div>
                    <label class="editor-label">Цитата</label>
                    <div class="input-with-controls">
                        <textarea class="editor-input editor-textarea testimonial-quote-input" data-index="${index}" rows="3">${testimonial.quote.text}</textarea>
                        <button class="format-menu-btn" data-target-section="testimonials" data-target-path="items.${index}.quote.text">⋮</button>
                    </div>
                    <label class="editor-label">Аватар (Инициалы)</label>
                    <input type="text" class="editor-input testimonial-avatar-input" data-index="${index}" value="${testimonial.avatar}">
                    <label class="editor-label">URL аватара (необязательно)</label>
                    <input type="text" class="editor-input testimonial-avatar-url-input" data-index="${index}" value="${testimonial.avatarUrl}" placeholder="Или URL изображения">
                `;
                testimonialsListDiv.appendChild(testimonialDiv);});
            addEventListenersToDynamicItems();}function renderFAQEditor(){const faqListDiv = document.getElementById('faq-list-editor');
            faqListDiv.innerHTML = '';
            pageConfig.faq.items.forEach((item, index) =>{const faqItemDiv = document.createElement('div');
                faqItemDiv.className = 'border border-gray-300 p-3 rounded-md space-y-2 relative bg-white';
                faqItemDiv.innerHTML = `
                    <button class="remove-item-btn" data-index="${index}" data-type="faq">×</button>
                    <label class="editor-label">Вопрос</label>
                    <div class="input-with-controls">
                        <input type="text" class="editor-input faq-question-input" data-index="${index}" value="${item.question.text}">
                        <button class="format-menu-btn" data-target-section="faq" data-target-path="items.${index}.question.text">⋮</button>
                    </div>
                    <label class="editor-label">Ответ</label>
                    <div class="input-with-controls">
                        <textarea class="editor-input editor-textarea faq-answer-input" data-index="${index}" rows="3">${item.answer.text}</textarea>
                        <button class="format-menu-btn" data-target-section="faq" data-target-path="items.${index}.answer.text">⋮</button>
                    </div>
                `;
                faqListDiv.appendChild(faqItemDiv);});
            addEventListenersToDynamicItems();}function renderContactFormEditor(){const container = document.getElementById('contact-form-fields-container');
            container.innerHTML = '';

            pageConfig.contact.form.fields.forEach((field, index) =>{const fieldDiv = document.createElement('div');
                fieldDiv.className = 'border border-gray-300 p-3 rounded-md space-y-2 relative bg-white';
                fieldDiv.dataset.index = index;

                const fieldTypeOptions = `
                    <option value="text" ${field.type === 'text' ? 'selected' : ''}>Текст</option>
                    <option value="email" ${field.type === 'email' ? 'selected' : ''}>Email</option>
                    <option value="tel" ${field.type === 'tel' ? 'selected' : ''}>Телефон</option>
                    <option value="number" ${field.type === 'number' ? 'selected' : ''}>Число</option>
                    <option value="textarea" ${field.type === 'textarea' ? 'selected' : ''}>Многострочный текст</option>
                `;

                fieldDiv.innerHTML = `
                    <button class="remove-item-btn" data-index="${index}" data-type="contact-field">×</button>
                    <label class="editor-label">Метка поля</label>
                    <div class="input-with-controls">
                        <input type="text" class="editor-input contact-field-label-input" value="${field.label.text}">
                        <button class="format-menu-btn" data-target-section="contact" data-target-path="form.fields.${index}.label.text">⋮</button>
                    </div>
                    <div class="mt-2">
                        <label class="editor-label">Плейсхолдер</label>
                        <div class="input-with-controls">
                            <input type="text" class="editor-input contact-field-placeholder-text-input" value="${field.placeholder.text}">
                            <input type="color" class="editor-input h-10 p-1 contact-field-placeholder-color-input" value="${field.placeholder.color}">
                        </div>
                    </div>
                    <div class="mt-2">
                        <label class="editor-label">Тип поля</label>
                        <select class="editor-input editor-select contact-field-type-select">
                            ${fieldTypeOptions}</select>
                    </div>
                    <div class="mt-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="editor-checkbox mr-2 contact-field-required-checkbox" ${field.required ? 'checked' : ''}>
                            <span>Обязательное поле</span>
                        </label>
                    </div>
                    <div class="mt-2 contact-field-rows-option ${field.type === 'textarea' ? '' : 'hidden'}">
                        <label class="editor-label">Количество строк (для многострочного текста)</label>
                        <input type="number" class="editor-input contact-field-rows-input" value="${field.rows || 4}" min="1" max="10">
                    </div>
                    <div class="mt-2 contact-field-image-options ${field.imageUrl ? '' : 'hidden'}">
                        <label class="editor-label">URL изображения (иконка)</label>
                        <input type="text" class="editor-input contact-field-image-url" value="${field.imageUrl}" placeholder="URL изображения/SVG">
                        <label class="editor-label mt-2">Ширина изображения (px)</label>
                        <input type="number" class="editor-input contact-field-image-width" value="${field.imageWidth || 24}" min="0">
                        <label class="editor-label mt-2">Высота изображения (px)</label>
                        <input type="number" class="editor-input contact-field-image-height" value="${field.imageHeight || 24}" min="0">
                    </div>
                    <div class="mt-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="editor-checkbox mr-2 contact-field-image-toggle" ${field.imageUrl ? 'checked' : ''}>
                            <span>Показать поля для изображения</span>
                        </label>
                    </div>
                `;
                container.appendChild(fieldDiv);});
            addEventListenersToDynamicItems();}// --- Обработчики событий для элементов управления редактора ---

        function setupEditorEventListeners(){// Переключение редактора
            document.getElementById('editor-toggle').addEventListener('click', toggleEditor);
            document.getElementById('editor-position-left').addEventListener('click', () => setEditorPosition('left'));
            document.getElementById('editor-position-right').addEventListener('click', () => setEditorPosition('right'));
document.getElementById('about-desc2-input').addEventListener('input', (e) =>{pageConfig.about.description2.text = e.target.value;
  updatePreview();});

// Навигационная панель - логотип
document.getElementById('navbar-logo-text').addEventListener('input', (e) =>{pageConfig.navbar.logoText = e.target.value;
    updatePreview();});
document.getElementById('navbar-logo-image-url').addEventListener('input', (e) =>{pageConfig.navbar.logoImageUrl = e.target.value;
    updatePreview();});
document.getElementById('navbar-logo-image-width').addEventListener('input', (e) =>{pageConfig.navbar.logoImageWidth = e.target.value;
    updatePreview();});
document.getElementById('navbar-logo-image-height').addEventListener('input', (e) =>{pageConfig.navbar.logoImageHeight = e.target.value;
    updatePreview();});
            // Глобальные настройки
            document.getElementById('global-bg').addEventListener('input', (e) =>{pageConfig.global.baseBgColor = e.target.value; updatePreview();});

            // Навигационная панель

            document.getElementById('toggle-navbar').addEventListener('change', (e) =>{pageConfig.navbar.visible = e.target.checked; updatePreview();});
            document.getElementById('nav-bg-color').addEventListener('input', (e) =>{pageConfig.navbar.bgColor = e.target.value; updatePreview();});
            document.getElementById('nav-text-color').addEventListener('input', (e) =>{pageConfig.navbar.textColor = e.target.value; updatePreview();});
            document.getElementById('add-nav-link-btn').addEventListener('click', () =>{pageConfig.navbar.links.push({text: 'Новая ссылка', href: '#new-section'});
                renderNavbarLinksEditor();
                updatePreview();});


            // Переключатели секций (чекбоксы)
            document.querySelectorAll('.section-toggle').forEach(checkbox =>{checkbox.addEventListener('change', (e) =>{const sectionKey = e.target.dataset.section;
                    pageConfig[sectionKey].visible = e.target.checked;
                    const sectionBlock = document.querySelector(`.section-editor-block[data-section="${sectionKey}"]`);
                    const content = sectionBlock.querySelector('.section-editor-content');
                    const header = sectionBlock.querySelector('.section-editor-header');
                    const arrow = header.querySelector('.accordion-arrow');

                    // Если снят флажок, скрыть весь блок секции и свернуть содержимое
                    if (!e.target.checked){document.getElementById(sectionKey).classList.add('section-hidden');
                        content.classList.add('hidden');
                        header.classList.add('collapsed');
                        arrow.classList.remove('rotate');}else{document.getElementById(sectionKey).classList.remove('section-hidden');
                        content.classList.remove('hidden'); // Показать содержимое по умолчанию, если видно
                        header.classList.remove('collapsed');
                        arrow.classList.add('rotate');}updatePreview();});});

            // Аккордеон секций (заголовки)
            document.querySelectorAll('.section-editor-header').forEach(header =>{header.addEventListener('click', (e) =>{// Предотвратить немедленное сворачивание при нажатии на чекбокс
                    if (e.target.classList.contains('section-toggle')) return;

                    const sectionBlock = header.closest('.section-editor-block');
                    const content = sectionBlock.querySelector('.section-editor-content');
                    const arrow = header.querySelector('.accordion-arrow');

                    content.classList.toggle('hidden');
                    header.classList.toggle('collapsed');
                    arrow.classList.toggle('rotate');});});


            // Элементы управления секции "Герой"
            document.getElementById('hero-title-input').addEventListener('input', (e) =>{pageConfig.hero.title.text = e.target.value; updatePreview();});
            document.getElementById('hero-desc-input').addEventListener('input', (e) =>{pageConfig.hero.description.text = e.target.value; updatePreview();});
            document.getElementById('hero-btn-text-input').addEventListener('input', (e) =>{pageConfig.hero.buttonText.text = e.target.value; updatePreview();});
            document.getElementById('hero-bg-type-select').addEventListener('change', (e) =>{pageConfig.hero.background.type = e.target.value;
                document.getElementById('hero-color-options').classList.toggle('hidden', e.target.value !== 'color');
                document.getElementById('hero-gradient-options').classList.toggle('hidden', e.target.value !== 'gradient');
                document.getElementById('hero-image-options').classList.toggle('hidden', e.target.value !== 'image');
                updatePreview();});
            document.getElementById('hero-button-text-color-picker').addEventListener('input', (e) =>{pageConfig.hero.buttonText.textColor = e.target.value;
  updatePreview();});
document.getElementById('hero-button-bg-color-picker').addEventListener('input', (e) =>{pageConfig.hero.buttonText.bgColor = e.target.value;
  updatePreview();});
            document.getElementById('hero-bg-color-picker').addEventListener('input', (e) =>{pageConfig.hero.background.color = e.target.value; updatePreview();});
            document.getElementById('hero-gradient-select').addEventListener('change', (e) =>{pageConfig.hero.background.gradientClass = e.target.value; updatePreview();});
            document.getElementById('hero-image-url-input').addEventListener('input', (e) =>{pageConfig.hero.background.imageUrl = e.target.value; updatePreview();});
            document.getElementById('hero-image-opacity-input').addEventListener('input', (e) =>{pageConfig.hero.background.imageOpacity = parseFloat(e.target.value); updatePreview();});
            document.getElementById('hero-text-color-picker').addEventListener('input', (e) =>{pageConfig.hero.textColor = e.target.value; updatePreview();});

            // Элементы управления секции "О нас"
            document.getElementById('about-title-input').addEventListener('input', (e) =>{pageConfig.about.title.text = e.target.value; updatePreview();});
            document.getElementById('about-desc-input').addEventListener('input', (e) =>{pageConfig.about.description.text = e.target.value; updatePreview();});
            document.getElementById('about-values-title-input').addEventListener('input', (e) =>{pageConfig.about.ourValues.title.text = e.target.value; updatePreview();});
            document.getElementById('about-bg-color-picker').addEventListener('input', (e) =>{pageConfig.about.bgColor = e.target.value; updatePreview();});
            document.getElementById('about-bg-image-url-input').addEventListener('input', (e) =>{pageConfig.about.bgImageUrl = e.target.value; updatePreview();});
            document.getElementById('about-bg-image-opacity-input').addEventListener('input', (e) =>{pageConfig.about.bgImageOpacity = parseFloat(e.target.value); updatePreview();});
            document.getElementById('about-text-color-picker').addEventListener('input', (e) =>{pageConfig.about.textColor = e.target.value; updatePreview();});
            document.getElementById('add-about-value-btn').addEventListener('click', () =>{pageConfig.about.ourValues.items.push({text: 'Новая ценность', styles:{}});
                renderAboutValuesEditor();
                updatePreview();});

            // Элементы управления секции "Услуги"
            document.getElementById('services-title-input').addEventListener('input', (e) =>{pageConfig.services.title.text = e.target.value; updatePreview();});
            document.getElementById('services-layout-select').addEventListener('change', (e) =>{pageConfig.services.layout = e.target.value; updatePreview();});
            document.getElementById('services-card-padding-select').addEventListener('change', (e) =>{pageConfig.services.cardPadding = e.target.value; updatePreview();});
            document.getElementById('services-gap-select').addEventListener('change', (e) =>{pageConfig.services.gap = e.target.value; updatePreview();});
            document.getElementById('services-bg-color-picker').addEventListener('input', (e) =>{pageConfig.services.bgColor = e.target.value; updatePreview();});
            document.getElementById('services-bg-image-url-input').addEventListener('input', (e) =>{pageConfig.services.bgImageUrl = e.target.value; updatePreview();});
            document.getElementById('services-bg-image-opacity-input').addEventListener('input', (e) =>{pageConfig.services.bgImageOpacity = parseFloat(e.target.value); updatePreview();});
            document.getElementById('services-text-color-picker').addEventListener('input', (e) =>{pageConfig.services.textColor = e.target.value; updatePreview();});
            document.getElementById('add-service-btn').addEventListener('click', () =>{const newService ={icon: '✨', iconUrl: '', title:{text: 'Новая Услуга', styles:{}}, description:{text: 'Описание новой услуги.', styles:{}}};
                pageConfig.services.items.push(newService);
                renderServicesEditor();
                updatePreview();});

            // Элементы управления секции "Особенности"
            document.getElementById('features-title-input').addEventListener('input', (e) =>{pageConfig.features.title.text = e.target.value; updatePreview();});
            document.getElementById('features-bg-color-picker').addEventListener('input', (e) =>{pageConfig.features.bgColor = e.target.value; updatePreview();});
            document.getElementById('features-bg-image-url-input').addEventListener('input', (e) =>{pageConfig.features.bgImageUrl = e.target.value; updatePreview();});
            document.getElementById('features-bg-image-opacity-input').addEventListener('input', (e) =>{pageConfig.features.bgImageOpacity = parseFloat(e.target.value); updatePreview();});
            document.getElementById('features-text-color-picker').addEventListener('input', (e) =>{pageConfig.features.textColor = e.target.value; updatePreview();});
            document.getElementById('add-feature-btn').addEventListener('click', () =>{const newFeature ={icon: '💡', iconUrl: '', title:{text: 'Новая Особенность', styles:{}}, description:{text: 'Описание новой особенности.', styles:{}}};
                pageConfig.features.items.push(newFeature);
                renderFeaturesEditor();
                updatePreview();});

            // Элементы управления секции "Отзывы"
            document.getElementById('testimonials-title-input').addEventListener('input', (e) =>{pageConfig.testimonials.title.text = e.target.value; updatePreview();});
            document.getElementById('testimonials-bg-color-picker').addEventListener('input', (e) =>{pageConfig.testimonials.bgColor = e.target.value; updatePreview();});
            document.getElementById('testimonials-bg-image-url-input').addEventListener('input', (e) =>{pageConfig.testimonials.bgImageUrl = e.target.value; updatePreview();});
            document.getElementById('testimonials-bg-image-opacity-input').addEventListener('input', (e) =>{pageConfig.testimonials.bgImageOpacity = parseFloat(e.target.value); updatePreview();});
            document.getElementById('testimonials-text-color-picker').addEventListener('input', (e) =>{pageConfig.testimonials.textColor = e.target.value; updatePreview();});
            document.getElementById('add-testimonial-btn').addEventListener('click', () =>{const newTestimonial ={avatar: 'НИ', avatarUrl: '', name:{text: 'Новый Клиент', styles:{}}, position:{text: 'Должность', styles:{}}, quote:{text: 'Это отличный отзыв!', styles:{}}};
                pageConfig.testimonials.items.push(newTestimonial);
                renderTestimonialsEditor();
                updatePreview();});

            // Элементы управления секции "Часто задаваемые вопросы"
            document.getElementById('faq-title-input').addEventListener('input', (e) =>{pageConfig.faq.title.text = e.target.value; updatePreview();});
            document.getElementById('faq-bg-color-picker').addEventListener('input', (e) =>{pageConfig.faq.bgColor = e.target.value; updatePreview();});
            document.getElementById('faq-bg-image-url-input').addEventListener('input', (e) =>{pageConfig.faq.bgImageUrl = e.target.value; updatePreview();});
            document.getElementById('faq-bg-image-opacity-input').addEventListener('input', (e) =>{pageConfig.faq.bgImageOpacity = parseFloat(e.target.value); updatePreview();});
            document.getElementById('faq-text-color-picker').addEventListener('input', (e) =>{pageConfig.faq.textColor = e.target.value; updatePreview();});
            document.getElementById('add-faq-btn').addEventListener('click', () =>{const newFaq ={question:{text: 'Новый Вопрос?', styles:{}}, answer:{text: 'Это ответ на новый вопрос.', styles:{}}};
                pageConfig.faq.items.push(newFaq);
                renderFAQEditor();
                updatePreview();});

            // Элементы управления секции "Контакты"
            document.getElementById('contact-title-input').addEventListener('input', (e) =>{pageConfig.contact.title.text = e.target.value; updatePreview();});
            document.getElementById('contact-bg-color-picker').addEventListener('input', (e) =>{pageConfig.contact.bgColor = e.target.value; updatePreview();});
            document.getElementById('contact-bg-image-url-input').addEventListener('input', (e) =>{pageConfig.contact.bgImageUrl = e.target.value; updatePreview();});
            document.getElementById('contact-bg-image-opacity-input').addEventListener('input', (e) =>{pageConfig.contact.bgImageOpacity = parseFloat(e.target.value); updatePreview();});
            document.getElementById('contact-text-color-picker').addEventListener('input', (e) =>{pageConfig.contact.textColor = e.target.value; updatePreview();});
            document.getElementById('contact-info-title-input').addEventListener('input', (e) =>{pageConfig.contact.infoBlock.title.text = e.target.value;
  updatePreview();});
            document.getElementById('contact-info-description-input').addEventListener('input', (e) =>{pageConfig.contact.infoBlock.description.text = e.target.value;
  updatePreview();});
            document.getElementById('contact-email-input').addEventListener('input', (e) =>{pageConfig.contact.info.email.text = e.target.value; updatePreview();});
            document.getElementById('contact-phone-input').addEventListener('input', (e) =>{pageConfig.contact.info.phone.text = e.target.value; updatePreview();});
            document.getElementById('contact-address-input').addEventListener('input', (e) =>{pageConfig.contact.info.address.text = e.target.value; updatePreview();});
            document.getElementById('submit-btn-text-input').addEventListener('input', (e) =>{pageConfig.contact.form.submitButtonText.text = e.target.value; updatePreview();});
            document.getElementById('add-contact-field-btn').addEventListener('click', () =>{const newField ={id: `field-${Date.now()}`, label:{text: 'Новое Поле', styles:{}}, type: 'text', required: false, imageUrl: '', imageWidth: 24, imageHeight: 24, placeholder:{text: 'Введите данные', color: '#a1a1a1'}};
                pageConfig.contact.form.fields.push(newField);
                renderContactFormEditor();
                updatePreview();});

            // Сохранение/Загрузка/Экспорт конфигурации
            document.getElementById('save-config-btn').addEventListener('click', () =>{try{localStorage.setItem('landingPageConfig', JSON.stringify(pageConfig));
                    alert('Конфигурация сохранена в локальное хранилище!');}catch (e){alert('Не удалось сохранить конфигурацию: ' + e.message);}});

            document.getElementById('load-config-btn').addEventListener('click', () =>{try{const savedConfig = localStorage.getItem('landingPageConfig');
                    if (savedConfig){pageConfig = JSON.parse(savedConfig);
                        populateEditorUI(); // Заполнить редактор загруженной конфигурацией
                        updatePreview();    // Обновить страницу загруженной конфигурацией
                        alert('Конфигурация загружена из локального хранилища!');}else{alert('В локальном хранилище не найдено сохраненных конфигураций.');}}catch (e){alert('Не удалось загрузить конфигурацию: ' + e.message);}});

            document.getElementById('export-config-js-btn').addEventListener('click', () =>{const configJsonString = JSON.stringify(pageConfig, null, 4); // Красивый вывод JSON
                const jsContent = `// Сгенерировано Конструктором Целевых Страниц\nwindow.pageConfig = ${configJsonString};`;

                const blob = new Blob([jsContent],{type: 'application/javascript'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'landing-page-config.js';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert('Конфигурация экспортирована как landing-page-config.js!');});

            // Обработчики для меню форматирования
            document.querySelectorAll('.format-menu-btn').forEach(button =>{button.addEventListener('click', (e) =>{e.stopPropagation(); // Предотвратить всплытие и закрытие других меню
                    const popupMenu = document.getElementById('format-popup-menu');
                    popupMenu.classList.remove('hidden');

                    const rect = e.target.getBoundingClientRect();
                    popupMenu.style.top = `${rect.bottom + window.scrollY + 5}px`;
                    popupMenu.style.left = `${rect.left + window.scrollX}px`;

                    const targetElementId = e.target.dataset.target;
                    const targetSection = e.target.dataset.targetSection; // Например, 'hero'
                    const targetPath = e.target.dataset.targetPath; // Например, 'title.text'

                    currentTargetElementId = targetElementId; // Сохраняем ID целевого элемента

                    let targetConfigItem;
                    if (targetPath){const pathParts = targetPath.split('.');
                        let current = pageConfig[targetSection];
                        for (let i = 0; i < pathParts.length; i++){if (current && pathParts[i]=== 'items' && pathParts[i+1]&& !isNaN(parseInt(pathParts[i+1]))){current = current[pathParts[i]][parseInt(pathParts[i+1])];
                                i++; // Пропустить следующий элемент, так как он уже обработан}else if (current){current = current[pathParts[i]];}else{current = null;
                                break;}}targetConfigItem = current;}else{// Для простых элементов, таких как hero-title
                        targetConfigItem = pageConfig.hero[targetElementId.replace('hero-', '').replace('-input', '')];}// Заполнить меню текущими стилями
                    const styles = (targetConfigItem && targetConfigItem.styles) ? targetConfigItem.styles :{};
                    document.getElementById('font-size-input').value = parseInt(styles.fontSize || '16px');
                    document.getElementById('font-size-display').textContent = `${document.getElementById('font-size-input').value}px`;
                    document.getElementById('font-weight-select').value = styles.fontWeight || 'normal';
                    document.getElementById('text-align-select').value = styles.textAlign || 'left';
                    document.getElementById('text-color-picker').value = styles.color || '#000000'; // Черный по умолчанию});});

            // Обновление значения размера шрифта при движении ползунка
            document.getElementById('font-size-input').addEventListener('input', (e) =>{document.getElementById('font-size-display').textContent = `${e.target.value}px`;});

            document.getElementById('apply-format-btn').addEventListener('click', () =>{const popupMenu = document.getElementById('format-popup-menu');
                popupMenu.classList.add('hidden');

                const fontSize = `${document.getElementById('font-size-input').value}px`;
                const fontWeight = document.getElementById('font-weight-select').value;
                const textAlign = document.getElementById('text-align-select').value;
                const textColor = document.getElementById('text-color-picker').value;

                let targetElementConfig;
                // Найдем соответствующий объект в pageConfig
                let targetElement = document.getElementById(currentTargetElementId);
                let configPath = '';

                // Определим путь к элементу в pageConfig
                if (currentTargetElementId === 'hero-title') configPath = 'hero.title';
                else if (currentTargetElementId === 'hero-description') configPath = 'hero.description';
                else if (currentTargetElementId === 'hero-button') configPath = 'hero.buttonText';
                else if (currentTargetElementId.startsWith('about-title-display')) configPath = 'about.title';
                else if (currentTargetElementId.startsWith('about-description-1-display')) configPath = 'about.description';
                else if (currentTargetElementId.startsWith('about-values-title-display')) configPath = 'about.ourValues.title';
                else if (currentTargetElementId.startsWith('about-value-')){const valueText = currentTargetElementId.replace('about-value-', '').replace(/-/g, ' ');
                    const item = pageConfig.about.ourValues.items.find(item => item.text === valueText);
                    if (item) targetElementConfig = item; // Уже нашли нужный объект}else if (currentTargetElementId.startsWith('service-')){const parts = currentTargetElementId.split('-'); // service-0-title
                    const index = parseInt(parts[1]);
                    const field = parts[2]; // title or description
                    if (field === 'title') targetElementConfig = pageConfig.services.items[index].title;
                    else if (field === 'description') targetElementConfig = pageConfig.services.items[index].description;}else if (currentTargetElementId.startsWith('feature-')){const parts = currentTargetElementId.split('-');
                    const index = parseInt(parts[1]);
                    const field = parts[2];
                    if (field === 'title') targetElementConfig = pageConfig.features.items[index].title;
                    else if (field === 'description') targetElementConfig = pageConfig.features.items[index].description;}else if (currentTargetElementId.startsWith('testimonial-')){const parts = currentTargetElementId.split('-');
                    const index = parseInt(parts[1]);
                    const field = parts[2];
                    if (field === 'name') targetElementConfig = pageConfig.testimonials.items[index].name;
                    else if (field === 'position') targetElementConfig = pageConfig.testimonials.items[index].position;
                    else if (field === 'quote') targetElementConfig = pageConfig.testimonials.items[index].quote;}else if (currentTargetElementId.startsWith('faq-')){const parts = currentTargetElementId.split('-');
                    const index = parseInt(parts[1]);
                    const field = parts[2];
                    if (field === 'question') targetElementConfig = pageConfig.faq.items[index].question;
                    else if (field === 'answer') targetElementConfig = pageConfig.faq.items[index].answer;}else if (currentTargetElementId.startsWith('display-contact-email')) configPath = 'contact.info.email';
                else if (currentTargetElementId.startsWith('display-contact-phone')) configPath = 'contact.info.phone';
                else if (currentTargetElementId.startsWith('display-contact-address')) configPath = 'contact.info.address';
                else if (currentTargetElementId.startsWith('contact-title-display')) configPath = 'contact.title';
                else if (currentTargetElementId.startsWith('contact-form-submit-btn')) configPath = 'contact.form.submitButtonText';
                else if (currentTargetElementId.endsWith('-label-display')){// Для меток полей формы
                    const fieldId = currentTargetElementId.replace('-label-display', '');
                    const field = pageConfig.contact.form.fields.find(f => f.id === fieldId);
                    if (field) targetElementConfig = field.label;}if (!targetElementConfig && configPath){const pathParts = configPath.split('.');
                    let current = pageConfig;
                    for (const part of pathParts){if (!current[part]){// Если путь не существует, создадим его
                            current[part]={};}current = current[part];}targetElementConfig = current;}if (targetElementConfig){if (!targetElementConfig.styles) targetElementConfig.styles ={};
                    targetElementConfig.styles.fontSize = fontSize;
                    targetElementConfig.styles.fontWeight = fontWeight;
                    targetElementConfig.styles.textAlign = textAlign;
                    targetElementConfig.styles.color = textColor;}updatePreview();});

            // Закрыть меню при клике вне его
            document.addEventListener('click', (e) =>{const popupMenu = document.getElementById('format-popup-menu');
                if (!popupMenu.classList.contains('hidden') && !popupMenu.contains(e.target) && !e.target.classList.contains('format-menu-btn')){popupMenu.classList.add('hidden');}});}// --- Обработчики событий для динамически добавленных элементов (например, услуги, особенности) ---
        function addEventListenersToDynamicItems(){// Общий обработчик для полей ввода в динамических списках
            document.querySelectorAll('.navbar-link-text-input, .navbar-link-href-input, .about-value-input, .service-title-input, .service-description-input, .service-icon-input, .service-icon-url-input, .feature-title-input, .feature-description-input, .feature-icon-input, .feature-icon-url-input, .testimonial-name-input, .testimonial-position-input, .testimonial-quote-input, .testimonial-avatar-input, .testimonial-avatar-url-input, .faq-question-input, .faq-answer-input, .contact-field-label-input, .contact-field-rows-input, .contact-field-image-url, .contact-field-image-width, .contact-field-image-height, .contact-field-placeholder-text-input').forEach(input =>{input.oninput = (e) =>{const index = parseInt(e.target.dataset.index);
                    const classList = e.target.classList;

                    if (classList.contains('navbar-link-text-input')) pageConfig.navbar.links[index].text = e.target.value;
                    else if (classList.contains('navbar-link-href-input')) pageConfig.navbar.links[index].href = e.target.value;
                    else if (classList.contains('about-value-input')) pageConfig.about.ourValues.items[index].text = e.target.value;
                    else if (classList.contains('service-title-input')) pageConfig.services.items[index].title.text = e.target.value;
                    else if (classList.contains('service-description-input')) pageConfig.services.items[index].description.text = e.target.value;
                    else if (classList.contains('service-icon-input')) pageConfig.services.items[index].icon = e.target.value;
                    else if (classList.contains('service-icon-url-input')) pageConfig.services.items[index].iconUrl = e.target.value;
                    else if (classList.contains('feature-title-input')) pageConfig.features.items[index].title.text = e.target.value;
                    else if (classList.contains('feature-description-input')) pageConfig.features.items[index].description.text = e.target.value;
                    else if (classList.contains('feature-icon-input')) pageConfig.features.items[index].icon = e.target.value;
                    else if (classList.contains('feature-icon-url-input')) pageConfig.features.items[index].iconUrl = e.target.value;
                    else if (classList.contains('testimonial-name-input')) pageConfig.testimonials.items[index].name.text = e.target.value;
                    else if (classList.contains('testimonial-position-input')) pageConfig.testimonials.items[index].position.text = e.target.value;
                    else if (classList.contains('testimonial-quote-input')) pageConfig.testimonials.items[index].quote.text = e.target.value;
                    else if (classList.contains('testimonial-avatar-input')) pageConfig.testimonials.items[index].avatar = e.target.value;
                    else if (classList.contains('testimonial-avatar-url-input')) pageConfig.testimonials.items[index].avatarUrl = e.target.value;
                    else if (classList.contains('faq-question-input')) pageConfig.faq.items[index].question.text = e.target.value;
                    else if (classList.contains('faq-answer-input')) pageConfig.faq.items[index].answer.text = e.target.value;
                    else if (classList.contains('contact-field-label-input')) pageConfig.contact.form.fields[index].label.text = e.target.value;
                    else if (classList.contains('contact-field-placeholder-text-input')) pageConfig.contact.form.fields[index].placeholder.text = e.target.value;
                    else if (classList.contains('contact-field-rows-input')) pageConfig.contact.form.fields[index].rows = parseInt(e.target.value, 10);
                    else if (classList.contains('contact-field-image-url')) pageConfig.contact.form.fields[index].imageUrl = e.target.value;
                    else if (classList.contains('contact-field-image-width')) pageConfig.contact.form.fields[index].imageWidth = parseInt(e.target.value, 10);
                    else if (classList.contains('contact-field-image-height')) pageConfig.contact.form.fields[index].imageHeight = parseInt(e.target.value, 10);

                    updatePreview();};});

            // Общий обработчик для селекторов в динамических списках
            document.querySelectorAll('.contact-field-type-select').forEach(select =>{select.onchange = (e) =>{const index = parseInt(e.target.closest('.border').dataset.index);
                    pageConfig.contact.form.fields[index].type = e.target.value;
                    const fieldRowsOption = e.target.closest('.border').querySelector('.contact-field-rows-option');
                    if (e.target.value === 'textarea'){fieldRowsOption.classList.remove('hidden');}else{fieldRowsOption.classList.add('hidden');}updatePreview();};});

            // Общий обработчик для чекбоксов в динамических списках
            document.querySelectorAll('.contact-field-required-checkbox').forEach(checkbox =>{checkbox.onchange = (e) =>{const index = parseInt(e.target.closest('.border').dataset.index);
                    pageConfig.contact.form.fields[index].required = e.target.checked;
                    updatePreview();};});

            document.querySelectorAll('.contact-field-image-toggle').forEach(checkbox =>{checkbox.onchange = (e) =>{const parentDiv = e.target.closest('.border');
                    const imageOptionsDiv = parentDiv.querySelector('.contact-field-image-options');
                    if (e.target.checked){imageOptionsDiv.classList.remove('hidden');}else{imageOptionsDiv.classList.add('hidden');
                        const index = parseInt(parentDiv.dataset.index);
                        pageConfig.contact.form.fields[index].imageUrl = ''; // Очистить URL, если скрыто
                        updatePreview();}};});

            // Обработчик для цвета плейсхолдера
            document.querySelectorAll('.contact-field-placeholder-color-input').forEach(input =>{input.oninput = (e) =>{const index = parseInt(e.target.closest('.border').dataset.index);
                    pageConfig.contact.form.fields[index].placeholder.color = e.target.value;
                    updatePreview();};});

            // Общий обработчик для кнопок удаления в динамических списках
            document.querySelectorAll('.remove-item-btn').forEach(button =>{button.onclick = (e) =>{const index = parseInt(e.target.dataset.index);
                    const type = e.target.dataset.type;

                    if (type === 'navbar-link') pageConfig.navbar.links.splice(index, 1);
                    else if (type === 'about-value') pageConfig.about.ourValues.items.splice(index, 1);
                    else if (type === 'service') pageConfig.services.items.splice(index, 1);
                    else if (type === 'feature') pageConfig.features.items.splice(index, 1);
                    else if (type === 'testimonial') pageConfig.testimonials.items.splice(index, 1);
                    else if (type === 'faq') pageConfig.faq.items.splice(index, 1);
                    else if (type === 'contact-field') pageConfig.contact.form.fields.splice(index, 1);

                    // Повторно отрисовать конкретный список
                    if (type === 'navbar-link') renderNavbarLinksEditor();
                    else if (type === 'about-value') renderAboutValuesEditor();
                    else if (type === 'service') renderServicesEditor();
                    else if (type === 'feature') renderFeaturesEditor();
                    else if (type === 'testimonial') renderTestimonialsEditor();
                    else if (type === 'faq') renderFAQEditor();
                    else if (type === 'contact-field') renderContactFormEditor();

                    updatePreview();};});}// --- Загрузчик внешнего JS конфига ---
        const configUrlLoader = document.getElementById('config-url-loader');
        const jsConfigUrlInput = document.getElementById('js-config-url-input');
        const loadExternalJsConfigBtn = document.getElementById('load-external-js-config-btn');
        const closeConfigUrlLoaderBtn = document.getElementById('close-config-url-loader-btn');

        function toggleExternalConfigLoader(){configUrlLoader.classList.toggle('hidden');
            configUrlLoader.classList.toggle('open');}closeConfigUrlLoaderBtn.addEventListener('click', toggleExternalConfigLoader);

        loadExternalJsConfigBtn.addEventListener('click', () =>{const configUrl = jsConfigUrlInput.value;
            if (configUrl){const existingScript = document.getElementById('dynamic-config-script');
                if (existingScript) existingScript.remove();

                const script = document.createElement('script');
                script.src = configUrl;
                script.id = 'dynamic-config-script';
                script.onload = () =>{if (typeof window.pageConfigExternal !== 'undefined'){pageConfig = window.pageConfigExternal;
                        alert('Внешняя конфигурация успешно загружена!');}else if (typeof window.pageConfig !== 'undefined' && script.src === configUrl){alert('Внешняя конфигурация успешно загружена!');}else{alert('Ошибка: Загруженный JS не содержит действительного объекта pageConfig.');
                        console.error('Загруженный JS не содержит действительного объекта pageConfig.');
                        return;}populateEditorUI();
                    updatePreview();
                    toggleExternalConfigLoader();};
                script.onerror = () =>{alert('Ошибка загрузки внешнего JS конфига. Проверьте URL и настройки CORS.');
                    console.error('Не удалось загрузить внешний JS конфиг:', configUrl);};
                document.body.appendChild(script);}else{alert('Пожалуйста, введите действительный URL для файла JS конфига.');}});


        // --- Начальная настройка при готовности DOM ---
        document.addEventListener('DOMContentLoaded', () =>{setupEditorEventListeners();
            populateEditorUI(); // Инициализировать UI редактора с конфигурацией по умолчанию
            updatePreview();    // Отформатировать страницу с конфигурацией по умолчанию

            // Плавная прокрутка для навигационных ссылок
            document.querySelectorAll('#nav-links a[href^="#"]').forEach(anchor =>{anchor.addEventListener('click', function(e){e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement){targetElement.scrollIntoView({behavior: 'smooth', block: 'start'});}});});

            // Горячие клавиши для редактора и загрузчика внешнего конфига (совместимость с русской раскладкой)
            document.addEventListener('keydown', function(e){// Alt + Е (русская 'У') для переключения редактора
                if (e.altKey && (e.key === 'e' || e.key === 'у' || e.code === 'KeyE')){e.preventDefault();
                    toggleEditor();}// Alt + Г (русская 'Т') для переключения загрузчика внешнего конфига
                if (e.altKey && (e.key === 'r' || e.key === 'к' || e.code === 'KeyR')){// 'r' is 'г' on russian layout
                    e.preventDefault();
                    toggleExternalConfigLoader();}});});
        document.getElementById("export-static-html-btn").addEventListener("click", () =>{updatePreview(); // убедимся, что всё применено

    // Удалим редактор из DOM
    const editorDrawer = document.getElementById("editor-drawer");
    if (editorDrawer) editorDrawer.remove();

    // Удалим все <script> теги кроме Tailwind и необходимых (например, если нужен interactivity)
    document.querySelectorAll("script").forEach(script =>{if (!script.src.includes("tailwind")){script.remove();}});

    // Получаем HTML всей страницы
    const htmlContent = `<!DOCTYPE html>\n` + document.documentElement.outerHTML;

    // Создаём файл
    const blob = new Blob([htmlContent],{type: "text/html"});
    const url = URL.createObjectURL(blob);

    // Создаём ссылку на скачивание
    const a = document.createElement("a");
    a.href = url;
    a.download = "landing-page.html";
    a.click();

    // Очистка
    URL.revokeObjectURL(url);
    alert("Готовый HTML-файл экспортирован.");});

    </script>
</body>
</html>
